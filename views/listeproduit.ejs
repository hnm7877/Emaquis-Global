<!DOCTYPE html>
<html lang="zxx">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-NT2SW8WBHT"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-NT2SW8WBHT");
    </script>
    <!-- End Google tag (gtag.js) -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="assets/js/jquery.min.js"></script>

    <title>E-maquis Admin</title>
    <!-- App css -->
    <link
      href="assets/css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/theme.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <script src="js/confetti.js"></script>
    <%- include('partial/head.ejs') %>

    <!-- PLUGINS CSS STYLE -->

    <link rel="stylesheet" href="../css/bootstrap.css" />
  </head>

  <body class="crm_body_bg">
    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1e40af;
        --primary-light: #3b82f6;
        --secondary-color: #1e293b;
        --accent-color: #ef4444;
        --success-color: #10b981;
        --info-color: #3b82f6;
        --warning-color: #f59e0b;
        --background-color: #f1f5f9;
        --surface-color: #ffffff;
        --text-primary: #0f172a;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
        --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
        --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --transition-speed: 0.3s;
        --border-radius: 12px;
        --border-radius-lg: 16px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .sidebar .logo .large_logo img {
        width: 70%;
        margin-left: 15%;
        transition: transform var(--transition-speed) ease;
      }

      .sidebar .logo .large_logo img:hover {
        transform: scale(1.05) rotate(2deg);
      }

      .main_content_iner {
        padding: 2rem;
        padding-top: 1.5rem;
        min-height: 100vh;
        overflow: visible;
        position: relative;
        z-index: 1;
      }

      .container-fluid {
        padding: 0 2rem;
        overflow: visible;
        position: relative;
        z-index: 1;
      }

      #root {
        overflow: visible;
        position: relative;
        z-index: 1;
      }

      .app-container {
        position: relative;
        z-index: 1;
        width: 100%;
      }

      /* Styles pour réduire le header sur petits appareils */
      #page-topbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
      }

      .main-navbar-pro {
        min-height: 64px;
      }

      /* Ajustement du padding-top pour le contenu principal */
      section.main_content {
        padding-top: 64px !important;
      }

      @media (max-width: 768px) {
        #page-topbar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }

        .main-navbar-pro {
          padding: 0.5rem 0.75rem !important;
          min-height: 50px !important;
          border-radius: 0 0 12px 12px !important;
        }

        .main-navbar-pro .navbar-icon {
          width: 80px !important;
          height: 44px !important;
          font-size: 1.2rem !important;
          padding: 0.25rem !important;
          margin-right: 0.5rem !important;
        }

        .main-navbar-pro .navbar-title {
          font-size: 0.9rem !important;
          font-weight: 600 !important;
        }

        .main-navbar-pro .navbar-user {
          font-size: 0.85rem !important;
          gap: 0.4rem !important;
        }

        .main-navbar-pro .navbar-user span {
          font-size: 0.85rem !important;
        }

        .main-navbar-pro .navbar-user .user-role {
          font-size: 0.75rem !important;
          margin-left: 0.25rem !important;
        }

        .main-navbar-pro .navbar-user i {
          font-size: 1rem !important;
          margin-left: 0.5rem !important;
        }

        section.main_content {
          padding-top: 50px !important;
        }

        .main_content_iner {
          padding-top: 0.75rem !important;
        }
      }

      @media (max-width: 576px) {
        #page-topbar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }

        .main-navbar-pro {
          padding: 0.4rem 0.5rem !important;
          min-height: 45px !important;
          border-radius: 0 0 10px 10px !important;
          flex-wrap: nowrap !important;
        }

        .main-navbar-pro .navbar-left {
          gap: 0.5rem !important;
          flex: 1;
          min-width: 0;
        }

        .main-navbar-pro .navbar-icon {
          width: 60px !important;
          height: 33px !important;
          font-size: 1rem !important;
          padding: 0.2rem !important;
          margin-right: 0.4rem !important;
        }

        .main-navbar-pro .navbar-title {
          font-size: 0.8rem !important;
          font-weight: 600 !important;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .main-navbar-pro .navbar-user {
          font-size: 0.75rem !important;
          gap: 0.3rem !important;
          flex-shrink: 0;
        }

        .main-navbar-pro .navbar-user span {
          font-size: 0.75rem !important;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 80px;
        }

        .main-navbar-pro .navbar-user .user-role {
          font-size: 0.7rem !important;
          margin-left: 0.2rem !important;
          display: none;
        }

        .main-navbar-pro .navbar-user i {
          font-size: 0.9rem !important;
          margin-left: 0.4rem !important;
        }

        section.main_content {
          padding-top: 45px !important;
        }

        .main_content_iner {
          padding: 0.5rem !important;
          padding-top: 0.5rem !important;
        }

        .container-fluid {
          padding: 0 0.5rem !important;
          padding-top: 0.5rem !important;
        }
      }

      @media (max-width: 400px) {
        .main-navbar-pro {
          padding: 0.35rem 0.4rem !important;
          min-height: 40px !important;
        }

        .main-navbar-pro .navbar-icon {
          width: 50px !important;
          height: 28px !important;
          font-size: 0.9rem !important;
          padding: 0.15rem !important;
          margin-right: 0.3rem !important;
        }

        .main-navbar-pro .navbar-title {
          font-size: 0.75rem !important;
        }

        .main-navbar-pro .navbar-user {
          font-size: 0.7rem !important;
        }

        .main-navbar-pro .navbar-user span {
          font-size: 0.7rem !important;
          max-width: 60px;
        }

        .main-navbar-pro .navbar-user i {
          font-size: 0.85rem !important;
          margin-left: 0.3rem !important;
        }

        section.main_content {
          padding-top: 40px !important;
        }

        .main_content_iner {
          padding: 0.4rem !important;
          padding-top: 0.4rem !important;
        }

        .container-fluid {
          padding: 0 0.4rem !important;
          padding-top: 0.4rem !important;
        }
      }

      /* Garantir la visibilité de l'en-tête */
      .page-header-modern {
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
        position: relative !important;
        z-index: 10 !important;
        margin-top: 0 !important;
        margin-bottom: 2rem !important;
        width: 100% !important;
        min-height: auto !important;
      }

      /* S'assurer que le conteneur parent ne cache pas l'en-tête */
      .main_content_iner .container-fluid {
        position: relative;
        z-index: 1;
        overflow: visible !important;
      }

      .main_content_iner .container-fluid .page-header-modern {
        position: relative;
        z-index: 10;
        overflow: visible !important;
      }

      /* S'assurer que la section main_content ne cache pas l'en-tête */
      section.main_content {
        overflow: visible !important;
      }

      section.main_content .main_content_iner {
        overflow: visible !important;
      }

      /* S'assurer que #root ne cache pas l'en-tête */
      #root {
        overflow: visible !important;
        position: relative !important;
        z-index: 1 !important;
      }

      #root .app-container {
        overflow: visible !important;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(-30px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .fade-in {
        animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .slide-in {
        animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Header moderne */
      .page-header-modern {
        background: linear-gradient(
          135deg,
          #1e40af 0%,
          #2563eb 50%,
          #3b82f6 100%
        );
        border-radius: 24px;
        padding: 3rem 2.5rem;
        margin-bottom: 2rem;
        margin-top: 0;
        color: white;
        box-shadow: 0 20px 60px rgba(37, 99, 235, 0.35),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        position: relative;
        overflow: visible;
        border: 2px solid rgba(255, 255, 255, 0.2);
        z-index: 10;
        width: 100%;
        display: block;
        visibility: visible;
        opacity: 1;
      }

      .page-header-modern::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: pulse 3s ease-in-out infinite;
      }

      .page-header-modern h1 {
        font-size: 2.75rem;
        font-weight: 800;
        margin: 0 0 0.75rem 0;
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #ffffff;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        letter-spacing: -0.02em;
        position: relative;
        z-index: 1;
      }

      .page-header-modern h1 i {
        font-size: 3rem;
        color: #ffffff;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
        animation: iconFloat 3s ease-in-out infinite;
      }

      .page-header-modern p {
        font-size: 1.125rem;
        opacity: 1;
        margin: 0;
        color: #ffffff;
        font-weight: 400;
        line-height: 1.6;
        text-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
        position: relative;
        z-index: 1;
      }

      @keyframes iconFloat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.6;
        }
      }

      /* Barre de recherche moderne */
      .search-bar-modern {
        margin-bottom: 2rem;
        position: relative;
      }

      .search-bar-modern .search-container {
        position: relative;
        max-width: 600px;
        margin: 0 auto;
      }

      .search-bar-modern .search-icon {
        position: absolute;
        left: 1.25rem;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
        font-size: 1.1rem;
        z-index: 2;
      }

      .search-bar-modern input {
        width: 100%;
        padding: 1rem 1rem 1rem 3.5rem;
        font-size: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        outline: none;
        transition: all 0.3s ease;
        background: #ffffff;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      }

      .search-bar-modern input:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      /* Total price container moderne */
      .total-price-container-modern {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border-radius: 16px;
        padding: 1.5rem 2rem;
        margin-bottom: 2rem;
        text-align: center;
        border: 2px solid #10b981;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.15);
        width: 100%;
        display: block;
        visibility: visible;
        opacity: 1;
        position: relative;
        z-index: 1;
      }

      .total-price-container-modern p {
        margin: 0;
        font-size: 1rem;
        color: #065f46;
        font-weight: 600;
      }

      .total-price-modern {
        font-size: 2rem;
        font-weight: 700;
        color: #10b981;
        margin-left: 0.5rem;
        text-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
      }

      /* Grille de produits moderne */
      .product-grid-container-modern {
        max-height: 70vh;
        overflow-y: auto;
        margin-bottom: 2rem;
        padding-right: 8px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) var(--border-color);
      }

      @media (max-width: 992px) {
        .product-grid-container-modern {
          max-height: 68vh;
        }
      }

      @media (max-width: 768px) {
        .product-grid-container-modern {
          max-height: 65vh;
          padding-right: 4px;
        }
      }

      @media (max-width: 576px) {
        .product-grid-container-modern {
          max-height: 60vh;
          padding-right: 4px;
        }
      }

      @media (max-width: 400px) {
        .product-grid-container-modern {
          max-height: 55vh;
        }
      }

      .product-grid-container-modern::-webkit-scrollbar {
        width: 8px;
      }

      .product-grid-container-modern::-webkit-scrollbar-track {
        background: var(--border-color);
        border-radius: 4px;
      }

      .product-grid-container-modern::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 4px;
      }

      .product-grid-modern {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
        padding: 0 1rem 1rem 1rem;
      }

      .product-card-modern {
        background: #ffffff;
        border-radius: 20px;
        padding: 0;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid #e2e8f0;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      .product-card-modern:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        border-color: #2563eb;
      }

      .product-image-container-modern {
        width: 100%;
        height: 220px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        border-bottom: 1px solid #e2e8f0;
        position: relative;
        overflow: hidden;
      }

      /* Badge de promotion */
      .promo-badge-modern {
        position: absolute;
        top: 12px;
        right: 12px;
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        padding: 0.5rem 0.875rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 0.375rem;
        animation: promoPulse 2s ease-in-out infinite;
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .promo-badge-modern i {
        font-size: 0.875rem;
      }

      @keyframes promoPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Informations de promotion */
      .promo-info-modern {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 2px solid #f59e0b;
        border-radius: 12px;
        padding: 1rem;
        margin-top: 0.75rem;
        margin-bottom: 0.75rem;
      }

      .promo-info-modern .promo-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
        color: #92400e;
        font-weight: 700;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .promo-info-modern .promo-header i {
        color: #f59e0b;
        font-size: 1rem;
      }

      .promo-info-modern .promo-details {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .promo-info-modern .promo-detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.875rem;
      }

      .promo-info-modern .promo-detail-item span:first-child {
        color: #78350f;
        font-weight: 600;
      }

      .promo-info-modern .promo-detail-item span:last-child {
        color: #92400e;
        font-weight: 700;
        font-size: 0.9375rem;
      }

      .promo-info-modern .promo-price-highlight {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 8px;
        font-weight: 700;
      }

      /* Prix avec promotion */
      .price-with-promo {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.25rem;
      }

      .price-original {
        text-decoration: line-through;
        color: #94a3b8 !important;
        font-size: 0.8125rem !important;
        font-weight: 500 !important;
      }

      .price-promo {
        color: #f59e0b !important;
        font-size: 1.0625rem !important;
        font-weight: 700 !important;
      }

      .product-image-modern {
        max-width: 75%;
        max-height: 180px;
        object-fit: contain;
        transition: transform 0.3s ease;
        border-radius: 8px;
      }

      .product-card-modern:hover .product-image-modern {
        transform: scale(1.1);
      }

      .product-info-modern {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .product-name-modern {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #0f172a;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .product-details-modern {
        margin-bottom: 1rem;
        flex: 1;
      }

      .product-detail-modern {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f1f5f9;
      }

      .product-detail-modern:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .product-detail-modern span:first-child {
        font-weight: 600;
        color: #64748b;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .product-detail-modern span:last-child {
        font-weight: 700;
        color: #0f172a;
        font-size: 0.9375rem;
      }

      .product-detail-modern span:first-child i {
        color: #2563eb;
        font-size: 0.875rem;
      }

      /* Responsive pour les cartes produits */
      @media (max-width: 1200px) {
        .product-card-modern:hover {
          transform: translateY(-4px);
        }
      }

      @media (max-width: 768px) {
        .product-card-modern:hover {
          transform: translateY(-2px);
        }
      }

      @media (max-width: 576px) {
        .product-card-modern:hover {
          transform: none;
        }
      }

      .product-actions-modern {
        display: flex;
        gap: 0.75rem;
        padding: 1rem;
        background: #f8fafc;
        border-top: 1px solid #e2e8f0;
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }

      .product-actions-modern button {
        flex: 1 1 0;
        min-width: 100px;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .product-actions-modern button i {
        font-size: 1rem;
      }

      .product-actions-modern button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .btn-success-modern {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      .btn-success-modern:hover {
        background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      }

      .btn-info-modern {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
      }

      .btn-info-modern:hover {
        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      }

      .btn-danger-modern {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
      }

      .btn-danger-modern:hover {
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      }

      /* Modals modernes */
      #myModal {
        z-index: 1060 !important;
        pointer-events: auto !important;
      }

      #myModal.show {
        z-index: 1060 !important;
        pointer-events: auto !important;
      }

      #myModal .modal-dialog {
        z-index: 1061 !important;
        position: relative;
        pointer-events: auto !important;
      }

      #myModal .modal-content {
        z-index: 1062 !important;
        position: relative;
        pointer-events: auto !important;
      }

      .modal-backdrop {
        z-index: 1040 !important;
        pointer-events: none !important;
      }

      .modal-backdrop.show {
        z-index: 1040 !important;
        pointer-events: none !important;
      }

      /* S'assurer que tous les éléments de la modal sont cliquables */
      #myModal * {
        pointer-events: auto !important;
      }

      /* Le backdrop ne doit pas intercepter les clics */
      body.modal-open .modal-backdrop {
        pointer-events: none !important;
      }

      .modal-content-modern {
        border-radius: 20px;
        border: none;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        position: relative;
        z-index: 1062 !important;
      }

      .modal-header-modern {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        color: white;
        border-bottom: none;
        padding: 1.75rem 2rem;
      }

      .modal-header-modern h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .modal-header-modern .close {
        color: white;
        opacity: 0.9;
        font-size: 1.75rem;
        transition: all 0.2s ease;
      }

      .modal-header-modern .close:hover {
        opacity: 1;
        transform: rotate(90deg);
      }

      .modal-body-modern {
        padding: 2rem;
        background: #f8fafc;
      }

      .modal-footer-modern {
        padding: 1.5rem 2rem;
        border-top: 1px solid #e2e8f0;
        background: #ffffff;
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }

      .modal-footer-modern button {
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      /* Responsive pour les modals */
      @media (max-width: 1200px) {
        #myModal .modal-dialog,
        #deleteModal .modal-dialog {
          max-width: 90% !important;
          margin: 1rem auto !important;
        }

        .modal-content-modern {
          border-radius: 16px;
        }

        .modal-header-modern {
          padding: 1.5rem 1.75rem;
        }

        .modal-body-modern {
          padding: 1.75rem;
        }

        .modal-footer-modern {
          padding: 1.25rem 1.75rem;
        }
      }

      @media (max-width: 992px) {
        #myModal .modal-dialog,
        #deleteModal .modal-dialog {
          max-width: 95% !important;
          margin: 0.75rem auto !important;
        }

        .modal-header-modern h2 {
          font-size: 1.25rem;
        }

        .modal-header-modern .close {
          font-size: 1.5rem;
        }

        .modal-body-modern {
          padding: 1.5rem;
        }

        .modal-footer-modern {
          padding: 1rem 1.5rem;
          flex-wrap: wrap;
        }

        .modal-footer-modern button {
          padding: 0.625rem 1.25rem;
          font-size: 0.9375rem;
        }
      }

      @media (max-width: 768px) {
        #myModal .modal-dialog,
        #deleteModal .modal-dialog {
          max-width: 95% !important;
          margin: 0.5rem auto !important;
        }

        .modal-content-modern {
          border-radius: 12px;
        }

        .modal-header-modern {
          padding: 1.25rem 1.5rem;
        }

        .modal-header-modern h2 {
          font-size: 1.125rem;
          gap: 0.5rem;
        }

        .modal-header-modern h2 i {
          font-size: 1rem;
        }

        .modal-header-modern .close {
          font-size: 1.375rem;
          padding: 0.25rem;
        }

        .modal-body-modern {
          padding: 1.25rem;
          max-height: calc(100vh - 200px);
          overflow-y: auto;
        }

        .modal-history-scroll {
          max-height: calc(100vh - 300px) !important;
        }

        .modal-footer-modern {
          padding: 1rem;
          flex-direction: column;
          gap: 0.75rem;
        }

        .modal-footer-modern button {
          width: 100%;
          padding: 0.75rem 1rem;
          font-size: 0.875rem;
        }
      }

      @media (max-width: 576px) {
        #myModal .modal-dialog,
        #deleteModal .modal-dialog {
          max-width: 100% !important;
          margin: 0 !important;
          height: 100vh;
          display: flex;
          align-items: flex-end;
        }

        .modal-content-modern {
          border-radius: 20px 20px 0 0;
          max-height: 90vh;
          display: flex;
          flex-direction: column;
        }

        .modal-header-modern {
          padding: 1rem 1.25rem;
          border-radius: 20px 20px 0 0;
        }

        .modal-header-modern h2 {
          font-size: 1rem;
          gap: 0.5rem;
        }

        .modal-header-modern h2 i {
          font-size: 0.9375rem;
        }

        .modal-header-modern .close {
          font-size: 1.25rem;
          padding: 0.25rem;
        }

        .modal-body-modern {
          padding: 1rem;
          overflow-y: auto;
          flex: 1;
          max-height: calc(90vh - 140px);
        }

        .modal-history-scroll {
          max-height: calc(90vh - 250px) !important;
        }

        .modal-footer-modern {
          padding: 0.875rem 1rem;
          flex-direction: column;
          gap: 0.625rem;
          border-top: 2px solid #e2e8f0;
        }

        .modal-footer-modern button {
          width: 100%;
          padding: 0.875rem 1rem;
          font-size: 0.875rem;
        }
      }

      @media (max-width: 400px) {
        .modal-header-modern {
          padding: 0.875rem 1rem;
        }

        .modal-header-modern h2 {
          font-size: 0.9375rem;
        }

        .modal-body-modern {
          padding: 0.875rem;
        }

        .modal-history-scroll {
          max-height: calc(90vh - 220px) !important;
        }

        .modal-footer-modern {
          padding: 0.75rem;
        }

        .modal-footer-modern button {
          padding: 0.75rem 0.875rem;
          font-size: 0.8125rem;
        }
      }

      /* Styles pour les éléments internes des modals sur petits écrans */
      @media (max-width: 576px) {
        .modal-body-modern h4 {
          font-size: 1rem !important;
        }

        .modal-body-modern [style*="padding: 1rem 1.25rem"] {
          padding: 0.875rem 1rem !important;
          font-size: 0.875rem !important;
        }

        .modal-body-modern [style*="width: 40px"] {
          width: 32px !important;
          height: 32px !important;
        }
      }

      /* Responsive */
      @media (min-width: 1400px) {
        .container-fluid {
          max-width: 1400px;
          margin: 0 auto;
        }

        .product-grid-modern {
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
      }

      @media (max-width: 1200px) {
        .container-fluid {
          padding: 0 1rem;
        }

        .search-bar-modern .search-container {
          max-width: 100%;
        }

        .product-grid-modern {
          grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
          gap: 1.25rem;
        }

        .total-price-container-modern {
          padding: 1.25rem 1.5rem;
        }

        .total-price-modern {
          font-size: 1.75rem;
        }
      }

      @media (max-width: 992px) {
        .main_content_iner {
          padding: 1.5rem;
          padding-top: 1rem !important;
        }

        .container-fluid {
          padding: 0 1rem;
        }

        .search-bar-modern {
          margin-bottom: 1.5rem;
        }

        .search-bar-modern .search-container {
          max-width: 100%;
        }

        .search-bar-modern input {
          padding: 0.875rem 1rem 0.875rem 3rem;
          font-size: 0.9375rem;
        }

        .search-bar-modern .search-icon {
          left: 1rem;
          font-size: 1rem;
        }

        .page-header-modern {
          padding: 2rem 1.5rem;
          margin-top: 1rem;
          visibility: visible;
          opacity: 1;
          display: block;
        }

        .page-header-modern h1 {
          font-size: 2.25rem;
        }

        .product-grid-modern {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1.25rem;
          padding: 0 0.75rem 1rem 0.75rem;
        }

        .product-card-modern {
          border-radius: 16px;
        }

        .product-image-container-modern {
          height: 200px;
        }

        .product-image-modern {
          max-width: 70%;
          max-height: 180px;
        }

        .product-info-modern {
          padding: 1.25rem;
        }

        .product-name-modern {
          font-size: 1.125rem;
        }

        .product-detail-modern {
          margin-bottom: 0.625rem;
        }

        .total-price-container-modern {
          padding: 1.25rem 1.5rem;
          margin-bottom: 1.5rem;
          border-radius: 14px;
        }

        .total-price-container-modern p {
          font-size: 0.9375rem;
        }

        .total-price-modern {
          font-size: 1.75rem;
        }

        .product-grid-container-modern {
          max-height: 68vh;
        }
      }

      @media (max-width: 768px) {
        .main_content_iner {
          padding: 1rem;
          padding-top: 1rem;
        }

        .container-fluid {
          padding: 0 0.75rem;
          padding-top: 0.5rem;
        }

        .search-bar-modern {
          margin-bottom: 1.25rem;
        }

        .search-bar-modern .search-container {
          max-width: 100%;
        }

        .search-bar-modern input {
          padding: 0.75rem 0.875rem 0.75rem 2.75rem;
          font-size: 0.875rem;
          border-radius: 10px;
        }

        .search-bar-modern .search-icon {
          left: 0.875rem;
          font-size: 0.9375rem;
        }

        .page-header-modern {
          padding: 1.5rem 1.25rem;
          border-radius: 16px;
          margin-top: 0.5rem;
          visibility: visible;
          opacity: 1;
          display: block;
          z-index: 10;
        }

        .page-header-modern h1 {
          font-size: 1.75rem;
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }

        .page-header-modern h1 i {
          font-size: 2rem;
        }

        .page-header-modern p {
          font-size: 1rem;
        }

        .product-grid-modern {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1rem;
          padding: 0 0.5rem 1rem 0.5rem;
        }

        .product-card-modern {
          border-radius: 14px;
        }

        .product-image-container-modern {
          height: 180px;
        }

        .product-image-modern {
          max-width: 70%;
          max-height: 160px;
        }

        .product-info-modern {
          padding: 1rem;
        }

        .product-name-modern {
          font-size: 1rem;
          margin-bottom: 0.75rem;
        }

        .product-detail-modern {
          margin-bottom: 0.5rem;
          padding: 0.375rem 0;
        }

        .product-detail-modern span:first-child {
          font-size: 0.8125rem;
        }

        .product-detail-modern span:last-child {
          font-size: 0.875rem;
        }

        .product-actions-modern {
          flex-direction: column;
          padding: 0.875rem;
          gap: 0.5rem;
        }

        .product-actions-modern button {
          width: 100%;
          padding: 0.625rem 0.875rem;
          font-size: 0.8125rem;
        }

        .total-price-container-modern {
          padding: 1rem 1.25rem;
          margin-bottom: 1.25rem;
          border-radius: 12px;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          width: 100% !important;
        }

        .total-price-container-modern p {
          font-size: 0.875rem;
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          align-items: center;
          gap: 0.375rem;
        }

        .total-price-modern {
          font-size: 1.5rem;
          margin-left: 0;
        }

        .product-grid-container-modern {
          max-height: 65vh;
        }
      }

      @media (max-width: 768px) {
        .promo-badge-modern {
          font-size: 0.6875rem;
          padding: 0.375rem 0.625rem;
          top: 8px;
          right: 8px;
        }

        .promo-info-modern {
          padding: 0.875rem;
          font-size: 0.8125rem;
        }

        .promo-info-modern .promo-header {
          font-size: 0.8125rem;
        }

        .promo-info-modern .promo-detail-item {
          font-size: 0.8125rem;
        }
      }

      @media (max-width: 576px) {
        .main_content_iner {
          padding: 0.75rem;
          padding-top: 0.75rem;
        }

        .container-fluid {
          padding: 0 0.5rem;
          padding-top: 0.5rem;
        }

        .search-bar-modern {
          margin-bottom: 1rem;
        }

        .search-bar-modern input {
          padding: 0.625rem 0.75rem 0.625rem 2.5rem;
          font-size: 0.8125rem;
          border-radius: 10px;
        }

        .search-bar-modern .search-icon {
          left: 0.75rem;
          font-size: 0.875rem;
        }

        .promo-badge-modern {
          font-size: 0.625rem;
          padding: 0.3125rem 0.5rem;
          top: 6px;
          right: 6px;
        }

        .promo-badge-modern i {
          font-size: 0.75rem;
        }

        .promo-info-modern {
          padding: 0.75rem;
          margin-top: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .promo-info-modern .promo-header {
          font-size: 0.75rem;
          margin-bottom: 0.5rem;
        }

        .promo-info-modern .promo-detail-item {
          font-size: 0.75rem;
        }

        .promo-info-modern .promo-detail-item span:last-child {
          font-size: 0.8125rem;
        }

        .price-with-promo {
          gap: 0.125rem;
        }

        .price-original {
          font-size: 0.75rem !important;
        }

        .price-promo {
          font-size: 0.9375rem !important;
        }

        .page-header-modern {
          padding: 1.25rem 1rem;
          margin-top: 0.5rem;
          visibility: visible;
          opacity: 1;
          display: block;
          z-index: 10;
        }

        .page-header-modern h1 {
          font-size: 1.5rem;
        }

        .product-grid-modern {
          grid-template-columns: 1fr;
          gap: 1rem;
          padding: 0 0.25rem 1rem 0.25rem;
        }

        .product-card-modern {
          border-radius: 12px;
        }

        .product-image-container-modern {
          height: 160px;
        }

        .product-image-modern {
          max-width: 65%;
          max-height: 140px;
        }

        .product-info-modern {
          padding: 0.875rem;
        }

        .product-name-modern {
          font-size: 0.9375rem;
          margin-bottom: 0.625rem;
        }

        .product-detail-modern {
          margin-bottom: 0.5rem;
          padding: 0.25rem 0;
        }

        .product-detail-modern span:first-child {
          font-size: 0.75rem;
        }

        .product-detail-modern span:last-child {
          font-size: 0.8125rem;
        }

        .product-actions-modern {
          padding: 0.75rem;
          gap: 0.5rem;
        }

        .product-actions-modern button {
          padding: 0.5625rem 0.75rem;
          font-size: 0.75rem;
        }

        .total-price-container-modern {
          padding: 0.875rem 1rem;
          margin-bottom: 1rem;
          border-radius: 10px;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }

        .total-price-container-modern p {
          font-size: 0.8125rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.25rem;
          flex-wrap: wrap;
        }

        .total-price-modern {
          font-size: 1.375rem;
          margin-left: 0;
          margin-top: 0.25rem;
        }

        .product-grid-container-modern {
          max-height: 60vh;
        }
      }

      @media (max-width: 400px) {
        .main_content_iner {
          padding: 0.5rem;
        }

        .container-fluid {
          padding: 0 0.25rem;
        }

        .search-bar-modern input {
          padding: 0.5625rem 0.625rem 0.5625rem 2.25rem;
          font-size: 0.75rem;
        }

        .search-bar-modern .search-icon {
          left: 0.625rem;
          font-size: 0.8125rem;
        }

        .product-grid-modern {
          gap: 0.875rem;
          padding: 0 0.125rem 1rem 0.125rem;
        }

        .product-info-modern {
          padding: 0.75rem;
        }

        .product-name-modern {
          font-size: 0.875rem;
        }

        .total-price-container-modern {
          padding: 0.75rem 0.5rem;
          margin-bottom: 0.875rem;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }

        .total-price-container-modern p {
          font-size: 0.75rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.25rem;
          flex-wrap: wrap;
          white-space: normal;
          word-wrap: break-word;
        }

        .total-price-modern {
          font-size: 1.125rem;
          margin-left: 0;
          margin-top: 0.25rem;
          display: inline-block;
        }
      }

      #status_btnn {
        display: inline-block;
        padding: 2px 15px;
        font-size: 11px;
        font-weight: 300;
        color: #fff !important;
        background: #ff9409;
        border-radius: 30px;
        text-transform: capitalize;
        white-space: nowrap;
        min-width: 70px;
        text-align: center;
      }

      .lms_checkbox_1 input:checked + .slider-check:before {
        transform: translateX(20px);
        background: #2eec1c;
      }

      .dataTables_scrollBody table thead {
        display: none;
      }
    </style>

    <!-- react js -->

    <%- include('partial/reactScript.ejs') %>

    <!--  -->
    <%- include('partial/newHead.ejs') %>
    <!--/ navbar  -->
    <%- include(user.role ===
    "Barman"?'partial/emsidebar.ejs':'partial/newSideBar.ejs') %>
    <!--/ sidebar  -->

    <section class="main_content dashboard_part large_header_bg">
      <!-- menu  -->
      <div id="root"></div>

      <div class="footer_part">
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-12">
              <div class="footer_iner text-center">
                <p>
                  2023 © E-MAQUIS - Designed by
                  <a href="#"> <i class="ti-gun"></i> </a><a href="#"> HNM</a> -
                  <a href="/faq">FAQ</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="menu-overlay"></div>
    <!--/### CHAT_MESSAGE_BOX  ### -->
    <div id="back-top" style="display: none">
      <a title="Go to Top" href="#">
        <i class="ti-angle-up"></i>
      </a>
    </div>
    <!-- footer  -->
    <!-- footer  -->
    <!-- jquery slim -->
    <%- include('partial/script.ejs') %>

    <!-- Données pour React (doivent être AVANT le script React) -->
    <script id="employee-data" type="application/json">
      <%- JSON.stringify(user) %>
    </script>
    <script id="products-data" type="application/json">
      <%- JSON.stringify(Result) %>
    </script>
    <script id="currency-data" type="application/json">
      <%- JSON.stringify(currency) %>
    </script>
    <script type="text/babel">
      const currency = JSON.parse(
        document.getElementById("currency-data").textContent
      );
      const AppContext = React.createContext();

      const ListProduits = ({ search }) => {
        const { handleSelectProduct, products } = React.useContext(AppContext);
        const employee = JSON.parse(
          document.getElementById("employee-data").textContent
        );
        const [quantities, setQuantities] = React.useState(
          products.reduce((acc, product) => {
            acc[product._id] = product.quantite;
            return acc;
          }, {})
        );

        const handleEdit = (productId) => {
          window.location.href = `/editproduit?productId=${productId}`;
        };

        const handleOpenModal = (product) => {
          handleSelectProduct(product);
        };

        const handleQuantityChange = (productId, newQuantity) => {
          setQuantities((prevQuantities) => ({
            ...prevQuantities,
            [productId]: newQuantity,
          }));
        };

        // Filtrage selon la recherche
        const filteredProducts = products.filter((el) => {
          const q = search.toLowerCase();
          return (
            el.produit.nom_produit.toLowerCase().includes(q) ||
            el.produit.categorie.nom.toLowerCase().includes(q) ||
            (el.taille && el.taille.toLowerCase().includes(q))
          );
        });

        const totalPrixVente = filteredProducts.reduce((total, el) => {
          return total + el.prix_vente * (quantities[el._id] || el.quantite);
        }, 0);

        return (
          <React.Fragment>
            <div
              className="total-price-container-modern fade-in"
              style={{
                display: "block",
                visibility: "visible",
                opacity: 1,
                width: "100%",
              }}
            >
              <p>
                <i
                  className="fas fa-chart-line"
                  style={{ marginRight: "0.5rem" }}
                ></i>
                Reste à vendre:{" "}
                <span className="total-price-modern">
                  {totalPrixVente.toLocaleString()} {currency}
                </span>
              </p>
            </div>
            <div className="product-grid-container-modern">
              <div className="product-grid-modern">
                {filteredProducts.map((el, prodId) => (
                  <div
                    key={prodId}
                    className="product-card-modern fade-in"
                    style={{
                      animationDelay: `${prodId * 0.05}s`,
                    }}
                  >
                    <div className="product-image-container-modern">
                      <img
                        src={
                          el.produit.image ||
                          "/images/paresseux_sous_parasol_DEF.png"
                        }
                        alt={el.produit.nom_produit}
                        className="product-image-modern"
                        onError={(e) => {
                          e.target.src =
                            "/images/paresseux_sous_parasol_DEF.png";
                        }}
                      />
                    </div>
                    <div className="product-info-modern">
                      <h3 className="product-name-modern">
                        {el.produit.nom_produit}
                      </h3>
                      <div className="product-details-modern">
                        <div className="product-detail-modern">
                          <span>
                            <i className="fas fa-tag"></i>
                            Catégorie
                          </span>
                          <span>{el.produit.categorie.nom}</span>
                        </div>
                        <div className="product-detail-modern">
                          <span>
                            <i className="fas fa-ruler"></i>
                            Taille
                          </span>
                          <span>{el.taille || "N/A"}</span>
                        </div>
                        <div className="product-detail-modern">
                          <span>
                            <i className="fas fa-money-bill-wave"></i>
                            Prix
                          </span>
                          {el.promo && el.promo_price ? (
                            <div className="price-with-promo">
                              <span className="price-original">
                                {el.prix_vente.toLocaleString()} {currency}
                              </span>
                              <span className="price-promo">
                                {el.promo_price.toLocaleString()} {currency}
                              </span>
                            </div>
                          ) : (
                            <span
                              style={{ color: "#10b981", fontWeight: "700" }}
                            >
                              {el.prix_vente.toLocaleString()} {currency}
                            </span>
                          )}
                        </div>
                        <div className="product-detail-modern">
                          <span>
                            <i className="fas fa-boxes"></i>
                            Quantité
                          </span>
                          <span
                            style={{
                              color: el.quantite > 0 ? "#10b981" : "#ef4444",
                              fontWeight: "700",
                            }}
                          >
                            {el.is_cocktail ? "∞" : el.quantite}
                          </span>
                        </div>
                        {el.promo && (
                          <div className="promo-info-modern">
                            <div className="promo-header">
                              <i className="fas fa-gift"></i>
                              Formule promotionnelle
                            </div>
                            <div className="promo-details">
                              <div className="promo-detail-item">
                                <span>
                                  <i
                                    className="fas fa-shopping-basket"
                                    style={{ marginRight: "0.5rem" }}
                                  ></i>
                                  Quantité requise
                                </span>
                                <span>{el.promo_quantity || "N/A"}</span>
                              </div>
                              <div className="promo-detail-item">
                                <span>
                                  <i
                                    className="fas fa-tag"
                                    style={{ marginRight: "0.5rem" }}
                                  ></i>
                                  Prix promotionnel
                                </span>
                                <span className="promo-price-highlight">
                                  {el.promo_price
                                    ? `${el.promo_price.toLocaleString()} ${currency}`
                                    : "N/A"}
                                </span>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                    <div className="product-actions-modern">
                      {employee.role !== "Barman" && (
                        <button
                          onClick={() => handleEdit(el._id)}
                          className="btn-success-modern"
                        >
                          <i className="fas fa-edit"></i>
                          Modifier
                        </button>
                      )}
                      <button
                        onClick={() => {
                          handleOpenModal(el);
                          setTimeout(() => {
                            $("#myModal").modal("show");
                            // S'assurer que le z-index est correct après l'ouverture
                            setTimeout(() => {
                              $("#myModal").css({
                                "z-index": "1060",
                                "pointer-events": "auto",
                              });
                              $(".modal-backdrop").css({
                                "z-index": "1040",
                                "pointer-events": "none",
                              });
                              // S'assurer que tous les backdrops ont le bon z-index et pointer-events
                              $(".modal-backdrop").each(function () {
                                $(this).css({
                                  "z-index": "1040",
                                  "pointer-events": "none",
                                });
                              });
                            }, 50);
                          }, 100);
                        }}
                        className="btn-info-modern"
                      >
                        <i className="fas fa-history"></i>
                        Historiques
                      </button>
                      {employee.role !== "Barman" && (
                        <button
                          onClick={() => {
                            handleOpenModal(el);
                            setTimeout(() => {
                              $("#deleteModal").modal("show");
                              // S'assurer que le z-index et pointer-events sont corrects après l'ouverture
                              setTimeout(() => {
                                $("#deleteModal").css({
                                  "z-index": "1060",
                                  "pointer-events": "auto",
                                });
                                $(".modal-backdrop").css({
                                  "z-index": "1040",
                                  "pointer-events": "none",
                                });
                                // S'assurer que tous les backdrops ont le bon z-index et pointer-events
                                $(".modal-backdrop").each(function () {
                                  $(this).css({
                                    "z-index": "1040",
                                    "pointer-events": "none",
                                  });
                                });
                              }, 50);
                            }, 100);
                          }}
                          className="btn-danger-modern"
                        >
                          <i className="fas fa-trash"></i>
                          Supprimer
                        </button>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </React.Fragment>
        );
      };

      const ModalHistoriques = () => {
        const { productSelected } = React.useContext(AppContext);

        const handleCloseModal = () => {
          // Méthode robuste pour fermer la modal Bootstrap
          if (typeof $ !== "undefined" && $("#myModal").length) {
            $("#myModal").modal("hide");
            // Nettoyer le backdrop et les classes
            setTimeout(() => {
              $("body").removeClass("modal-open");
              // Supprimer tous les backdrops
              $(".modal-backdrop").each(function () {
                $(this).remove();
              });
              $("#myModal").removeClass("show");
              $("#myModal").css("display", "none");
              $("#myModal").attr("aria-hidden", "true");
            }, 300);
          } else {
            // Fallback si jQuery n'est pas disponible
            const modal = document.getElementById("myModal");
            if (modal) {
              modal.classList.remove("show");
              modal.style.display = "none";
              modal.setAttribute("aria-hidden", "true");
              document.body.classList.remove("modal-open");
              // Supprimer tous les backdrops
              const backdrops = document.querySelectorAll(".modal-backdrop");
              backdrops.forEach((backdrop) => backdrop.remove());
            }
          }
        };

        React.useEffect(() => {
          // Fermer la modal quand productSelected change ou devient null
          if (!productSelected || !productSelected.produit) {
            handleCloseModal();
          }
        }, [productSelected]);

        React.useEffect(() => {
          // Surveiller et corriger le z-index et pointer-events du backdrop après l'ouverture
          const checkBackdrop = setInterval(() => {
            if (
              $("#myModal").hasClass("show") ||
              $("#deleteModal").hasClass("show")
            ) {
              $(".modal-backdrop").css({
                "z-index": "1040",
                "pointer-events": "none",
              });
              $("#myModal, #deleteModal").css({
                "z-index": "1060",
                "pointer-events": "auto",
              });
              // S'assurer que tous les éléments des modals sont cliquables
              $("#myModal *, #deleteModal *").css({
                "pointer-events": "auto",
              });
            }
          }, 100);

          // Gérer la touche Escape pour fermer la modal
          const handleEscape = (e) => {
            if (e.key === "Escape") {
              const modal = document.getElementById("myModal");
              if (modal && modal.classList.contains("show")) {
                handleCloseModal();
              }
            }
          };

          document.addEventListener("keydown", handleEscape);

          return () => {
            clearInterval(checkBackdrop);
            document.removeEventListener("keydown", handleEscape);
          };
        }, []);

        return (
          <div
            className="modal fade"
            id="myModal"
            tabIndex="-1"
            role="dialog"
            aria-labelledby="myModalTitle"
            data-backdrop="true"
            data-keyboard="true"
            style={{
              zIndex: 1060,
              position: "fixed",
            }}
            onClick={(e) => {
              // Fermer la modal si on clique sur le backdrop (pas sur le contenu)
              if (
                e.target.id === "myModal" ||
                e.target.classList.contains("modal")
              ) {
                handleCloseModal();
              }
            }}
          >
            <div
              className="modal-dialog modal-dialog-centered"
              style={{
                maxWidth: "700px",
                zIndex: 1061,
                position: "relative",
                width: "100%",
              }}
              role="document"
              onClick={(e) => {
                // Empêcher la propagation du clic pour éviter de fermer la modal
                e.stopPropagation();
              }}
            >
              {!!productSelected && productSelected.produit && (
                <div
                  className="modal-content modal-content-modern"
                  style={{
                    zIndex: 1062,
                    position: "relative",
                  }}
                >
                  <div className="modal-header modal-header-modern">
                    <h2 className="modal-title" id="exampleModalLongTitle">
                      <i className="fas fa-history"></i>
                      Historiques des modifications
                    </h2>
                    <button
                      type="button"
                      className="close close-modal"
                      onClick={handleCloseModal}
                      aria-label="Close"
                      id="close-modal"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div className="modal-body modal-body-modern">
                    <div
                      style={{
                        background: "white",
                        padding: "1.5rem",
                        borderRadius: "12px",
                        marginBottom: "1.5rem",
                        border: "2px solid #e2e8f0",
                      }}
                    >
                      <h4
                        style={{
                          fontSize: "1.25rem",
                          fontWeight: "700",
                          color: "#0f172a",
                          margin: "0 0 0.5rem 0",
                          display: "flex",
                          alignItems: "center",
                          gap: "0.75rem",
                        }}
                      >
                        <i
                          className="fas fa-box"
                          style={{ color: "#2563eb" }}
                        ></i>
                        {productSelected.produit.nom_produit}{" "}
                        {productSelected.taille}
                      </h4>
                    </div>
                    <div
                      className="modal-history-scroll"
                      style={{
                        maxHeight: "400px",
                        overflowY: "auto",
                        paddingRight: "0.5rem",
                      }}
                    >
                      {productSelected.historiques &&
                        productSelected.historiques
                          .reverse()
                          .map((el, index) => {
                            return (
                              <div
                                key={index}
                                style={{
                                  background: "white",
                                  padding: "1rem 1.25rem",
                                  borderRadius: "12px",
                                  marginBottom: "0.75rem",
                                  border: "1px solid #e2e8f0",
                                  transition: "all 0.3s ease",
                                }}
                                onMouseEnter={(e) => {
                                  e.currentTarget.style.borderColor = "#2563eb";
                                  e.currentTarget.style.boxShadow =
                                    "0 2px 8px rgba(37, 99, 235, 0.1)";
                                }}
                                onMouseLeave={(e) => {
                                  e.currentTarget.style.borderColor = "#e2e8f0";
                                  e.currentTarget.style.boxShadow = "none";
                                }}
                              >
                                <div
                                  style={{
                                    display: "flex",
                                    alignItems: "flex-start",
                                    gap: "1rem",
                                  }}
                                >
                                  <div
                                    style={{
                                      width: "40px",
                                      height: "40px",
                                      borderRadius: "50%",
                                      background: el.update
                                        ? "linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)"
                                        : "linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)",
                                      display: "flex",
                                      alignItems: "center",
                                      justifyContent: "center",
                                      flexShrink: 0,
                                    }}
                                  >
                                    <i
                                      className={
                                        el.update
                                          ? "fas fa-edit"
                                          : "fas fa-plus"
                                      }
                                      style={{
                                        color: el.update
                                          ? "#f59e0b"
                                          : "#2563eb",
                                        fontSize: "1rem",
                                      }}
                                    ></i>
                                  </div>
                                  <div style={{ flex: 1 }}>
                                    <p
                                      style={{
                                        margin: "0 0 0.5rem 0",
                                        fontSize: "0.9375rem",
                                        color: "#0f172a",
                                        fontWeight: "600",
                                      }}
                                    >
                                      <strong>{el.add_by}</strong> a{" "}
                                      {el.update
                                        ? `modifié la quantité de ${
                                            el.prev_quantite
                                          } à ${
                                            el.stockType === "locker"
                                              ? `${el.lockerQty} casier(s) de ${el.quantite} bouteilles`
                                              : el.quantite
                                          }`
                                        : `ajouté ${
                                            el.stockType === "locker"
                                              ? `${el.lockerQty} casier(s) de ${el.quantite} bouteilles`
                                              : `${el.quantite} quantité(s)`
                                          }`}
                                    </p>
                                    <p
                                      style={{
                                        margin: 0,
                                        fontSize: "0.875rem",
                                        color: "#64748b",
                                        display: "flex",
                                        alignItems: "center",
                                        gap: "0.5rem",
                                      }}
                                    >
                                      <i className="fas fa-clock"></i>
                                      {new Date(el.date).toLocaleDateString(
                                        "fr-FR",
                                        {
                                          year: "numeric",
                                          month: "long",
                                          day: "numeric",
                                          hour: "numeric",
                                          minute: "numeric",
                                          second: "numeric",
                                        }
                                      )}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                    </div>
                  </div>
                  <div className="modal-footer modal-footer-modern">
                    <button
                      type="button"
                      className="btn-success-modern"
                      style={{
                        padding: "0.75rem 2rem",
                        borderRadius: "10px",
                        border: "none",
                        color: "white",
                        fontWeight: "600",
                        cursor: "pointer",
                      }}
                      onClick={handleCloseModal}
                    >
                      <i className="fas fa-check"></i> Fermer
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      const ModalDelete = () => {
        const { productSelected, handleRemoveProduct } =
          React.useContext(AppContext);
        const [loading, setLoading] = React.useState(false);

        const handleDelete = () => {
          setLoading(true);
          fetch("/deleteproduit/" + productSelected._id, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((res) => res.json())
            .then((data) => {
              $(".close-modal").each(function () {
                $(this).trigger("click");
              });
              setLoading(false);
              handleRemoveProduct(productSelected._id);
            });
        };

        return (
          <div
            className="modal fade"
            id="deleteModal"
            tabIndex="-1"
            role="dialog"
            aria-labelledby="myModalDeleteTitle"
            style={{
              zIndex: 1060,
              position: "fixed",
              pointerEvents: "auto",
            }}
          >
            <div
              className="modal-dialog modal-dialog-centered"
              style={{
                maxWidth: "600px",
              }}
              role="document"
            >
              {!!productSelected && productSelected.produit && (
                <div className="modal-content modal-content-modern">
                  <div
                    className="modal-header modal-header-modern"
                    style={{
                      background:
                        "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",
                    }}
                  >
                    <h2 className="modal-title" id="exampleModalLongTitle">
                      <i className="fas fa-exclamation-triangle"></i>
                      Suppression du produit
                    </h2>
                    <button
                      type="button"
                      className="close close-modal"
                      data-dismiss="modal"
                      aria-label="Close"
                      id="close-delete-modal"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div className="modal-body modal-body-modern">
                    <div
                      style={{
                        textAlign: "center",
                        padding: "1rem 0",
                      }}
                    >
                      <div
                        style={{
                          width: "80px",
                          height: "80px",
                          margin: "0 auto 1.5rem",
                          borderRadius: "50%",
                          background:
                            "linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)",
                          display: "flex",
                          alignItems: "center",
                          justifyContent: "center",
                          border: "3px solid #ef4444",
                        }}
                      >
                        <i
                          className="fas fa-trash"
                          style={{
                            fontSize: "2rem",
                            color: "#ef4444",
                          }}
                        ></i>
                      </div>
                      <h4
                        style={{
                          fontSize: "1.25rem",
                          fontWeight: "700",
                          color: "#0f172a",
                          marginBottom: "0.5rem",
                        }}
                      >
                        Confirmer la suppression
                      </h4>
                      <p
                        style={{
                          fontSize: "1rem",
                          color: "#64748b",
                          margin: 0,
                        }}
                      >
                        Voulez-vous vraiment supprimer le produit{" "}
                        <strong style={{ color: "#0f172a" }}>
                          {productSelected.produit.nom_produit}{" "}
                          {productSelected.taille}
                        </strong>{" "}
                        ?
                      </p>
                      <p
                        style={{
                          fontSize: "0.875rem",
                          color: "#ef4444",
                          marginTop: "0.75rem",
                          fontWeight: "600",
                        }}
                      >
                        <i className="fas fa-exclamation-circle"></i> Cette
                        action est irréversible
                      </p>
                    </div>
                  </div>

                  <div className="modal-footer modal-footer-modern">
                    <button
                      type="button"
                      className="btn-success-modern"
                      style={{
                        padding: "0.75rem 2rem",
                        borderRadius: "10px",
                        border: "none",
                        color: "white",
                        fontWeight: "600",
                        cursor: "pointer",
                        background: "#64748b",
                      }}
                      data-dismiss="modal"
                    >
                      <i className="fas fa-times"></i> Annuler
                    </button>
                    <button
                      type="button"
                      className="btn-danger-modern"
                      onClick={handleDelete}
                      disabled={loading}
                      style={{
                        padding: "0.75rem 2rem",
                        borderRadius: "10px",
                        border: "none",
                        color: "white",
                        fontWeight: "600",
                        cursor: loading ? "not-allowed" : "pointer",
                        opacity: loading ? 0.7 : 1,
                      }}
                    >
                      {loading ? (
                        <React.Fragment>
                          <i className="fas fa-spinner fa-spin"></i>{" "}
                          Suppression...
                        </React.Fragment>
                      ) : (
                        <React.Fragment>
                          <i className="fas fa-trash"></i> Supprimer
                        </React.Fragment>
                      )}
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      const App = () => {
        const [search, setSearch] = React.useState("");
        return (
          <div className="app-container">
            <div className="main_content_iner fade-in">
              <div className="container-fluid p-0">
                {/* Barre de recherche moderne */}
                <div className="search-bar-modern">
                  <div className="search-container">
                    <i className="fas fa-search search-icon"></i>
                    <input
                      type="text"
                      placeholder="Rechercher un produit, une catégorie, une taille..."
                      value={search}
                      onChange={(e) => setSearch(e.target.value)}
                    />
                  </div>
                </div>

                {/* Liste des produits */}
                <ListProduits search={search} />
              </div>
            </div>
            <ModalHistoriques />
            <ModalDelete />
          </div>
        );
      };

      const AppRoot = () => {
        const [productSelected, setProductSelected] = React.useState(null);
        const [products, setProducts] = React.useState(
          JSON.parse(document.getElementById("products-data").textContent)
        );

        const handleSelectProduct = (product) => {
          setProductSelected(product);
        };

        const handleRemoveProduct = (id) => {
          setProducts(products.filter((el) => el._id !== id));
          setProductSelected(null);
        };

        return (
          <AppContext.Provider
            value={{
              productSelected,
              handleSelectProduct,
              handleRemoveProduct,
              products,
            }}
          >
            <App />
          </AppContext.Provider>
        );
      };

      ReactDOM.render(<AppRoot />, document.getElementById("root"));
    </script>

    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/metismenu.min.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/simplebar.min.js"></script>

    <!-- Morris Js-->
    <script src="../plugins/morris-js/morris.min.js"></script>
    <!-- Raphael Js-->
    <script src="../plugins/raphael/raphael.min.js"></script>

    <!-- Morris Custom Js-->
    <script src="assets/pages/dashboard-demo.js"></script>

    <!-- App js -->
    <script src="assets/js/theme.js"></script>
  </body>
</html>
