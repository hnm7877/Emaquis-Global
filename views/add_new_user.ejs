<!DOCTYPE html>
<html lang="zxx">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-NT2SW8WBHT"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-NT2SW8WBHT");
    </script>
    <!-- End Google tag (gtag.js) -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="assets/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css"
    />
    <title>Ajout employé(es)</title>
    <!-- App css -->
    <link
      href="assets/css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/theme.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #4e73df;
        --secondary-color: #1cc88a;
        --danger-color: #e74a3b;
        --warning-color: #f6c23e;
        --dark-color: #5a5c69;
      }

      .form-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-top: 2rem;
      }

      .nav-tabs {
        border: none;
        margin-bottom: 2rem;
      }

      .nav-tabs .nav-link {
        border: none;
        color: var(--dark-color);
        padding: 1rem 2rem;
        border-radius: 10px;
        margin-right: 0.5rem;
        transition: all 0.3s ease;
      }

      .nav-tabs .nav-link:hover {
        background: rgba(78, 115, 223, 0.1);
      }

      .nav-tabs .nav-link.active {
        background: var(--primary-color);
        color: white;
      }

      .nav-tabs .nav-link i {
        margin-right: 0.5rem;
      }

      .form-focus {
        border: 2px solid #e3e6f0;
        border-radius: 10px;
        padding: 0.8rem 1rem;
        transition: all 0.3s ease;
      }

      .form-focus:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
      }

      .btn_1 {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .btn_1:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(78, 115, 223, 0.3);
      }

      .alert {
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
        animation: fadeIn 0.5s ease;
      }

      .form-step {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .form-step.active {
        display: block;
      }

      .progress-bar {
        height: 5px;
        background: var(--primary-color);
        transition: width 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .input-group-text {
        background: var(--primary-color);
        color: white;
        border: none;
      }

      .nice_Select2 {
        border-radius: 10px;
        padding: 0.8rem;
      }

      .form-label {
        color: var(--dark-color);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .required-field::after {
        content: "*";
        color: var(--danger-color);
        margin-left: 4px;
      }
    </style>
    <%- include('partial/newSideBar.ejs') %>
    <!--/ sidebar  -->

    <%- include('partial/newHead.ejs') %>
    <!--/ navbar  -->
  </head>

  <body class="crm_body_bg">
    <%- include('partial/newSideBar.ejs') %>

    <!--/ sidebar  -->

    <section class="main_content dashboard_part large_header_bg">
      <!-- menu  -->

      <!--/ menu  -->
      <div class="main_content_iner overly_inner">
        <div class="container-fluid p-0">
          <!-- page title  -->
          <!-- page title  -->
          <div class="row">
            <div class="col-12">
              <div
                class="page_title_box d-flex flex-wrap align-items-center justify-content-between"
              >
                <div class="page_title_left d-flex align-items-center">
                  <!--
                <h3 class="f_s_25 f_w_700 dark_text mr_30">
                  Tableau de bord
                </h3>
                  <ol class="breadcrumb page_bradcam mb-0">
                    <li class="breadcrumb-item">
                      <a href="javascript:void(0);">Acceuil</a>
                    </li>
                    <li class="breadcrumb-item active">Analyse</li>
                  </ol> 
                  -->
                </div>
                <div class="page_title_right">
                  <div class="page_title_right d-flex">
                    <div class="page_date d-flex align-items-center">
                      <div class="date_content ml-2">
                        <span id="heure"></span>
                        <script>
                          setInterval("heure()", 1000);
                        </script>
                      </div>
                    </div>
                    <div class="page_date d-flex align-items-center">
                      <div class="date_content ml-2">
                        <span id="date"></span>
                      </div>
                    </div>
                    <div class="page_date_button d-flex align-items-center">
                      <script>
                        var d = new Date();
                        //affichage de la date du jour
                        var jour = d.getDate();
                        var mois = d.getMonth();
                        var annee = d.getFullYear();
                        var date = jour + "/" + (mois + 1) + "/" + annee;
                        document.getElementById("date").innerHTML = date;
                        //affichage de l'heure dynamique
                        function heure() {
                          var d = new Date();
                          var h = d.getHours();
                          var m = d.getMinutes();
                          var s = d.getSeconds();
                          if (h < 10) {
                            h = "0" + h;
                          }
                          if (m < 10) {
                            m = "0" + m;
                          }
                          if (s < 10) {
                            s = "0" + s;
                          }
                          document.getElementById("heure").innerHTML =
                            h + ":" + m + ":" + s;
                        }
                      </script>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <p id="sess" hidden><%= user?.id %></p>
              <div class="form-container">
                <h3
                  class="text-center mb-4 animate__animated animate__fadeInDown"
                >
                  <i class="fas fa-user-plus me-2"></i>Ajouter un nouvel employé
                </h3>

                <div class="progress mb-4">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>

                <ul class="nav nav-tabs" id="formTabs" role="tablist">
                  <li class="nav-item">
                    <a
                      class="nav-link active"
                      id="personal-tab"
                      data-toggle="tab"
                      href="#personal"
                      role="tab"
                    >
                      <i class="fas fa-user"></i> Informations Personnelles
                    </a>
                  </li>
                  <li class="nav-item">
                    <a
                      class="nav-link"
                      id="contact-tab"
                      data-toggle="tab"
                      href="#contact"
                      role="tab"
                    >
                      <i class="fas fa-address-book"></i> Contact
                    </a>
                  </li>
                  <li class="nav-item">
                    <a
                      class="nav-link"
                      id="security-tab"
                      data-toggle="tab"
                      href="#security"
                      role="tab"
                    >
                      <i class="fas fa-shield-alt"></i> Sécurité
                    </a>
                  </li>
                  <li class="nav-item">
                    <a
                      class="nav-link"
                      id="role-tab"
                      data-toggle="tab"
                      href="#role"
                      role="tab"
                    >
                      <i class="fas fa-user-tag"></i> Rôle
                    </a>
                  </li>
                </ul>

                <form action="" method="" id="employeeForm">
                  <% if(locals.update) { %>
                  <div
                    class="alert alert-success"
                    role="alert"
                    style="text-align: center; display: none"
                    id="alert-success"
                  >
                    Employé modifier avec succès !
                  </div>
                  <% } else { %>
                  <div
                    class="alert alert-success"
                    role="alert"
                    style="text-align: center; display: none"
                    id="alert-success"
                  >
                    Nouvel employé enregistrer avec succès !
                  </div>
                  <% } %>
                  <div
                    class="alert alert-danger"
                    role="alert"
                    style="text-align: center; display: none"
                    id="alert-danger"
                  >
                    Echec de l'opération, veuillez recommencer!
                  </div>

                  <div class="tab-content">
                    <div
                      class="tab-pane fade show active"
                      id="personal"
                      role="tabpanel"
                    >
                      <div class="row">
                        <div class="col-md-6">
                          <label class="form-label required-field"
                            >Prénom</label
                          >
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-user"></i
                            ></span>
                            <input
                              type="text"
                              class="form-focus"
                              name="prenom"
                              required
                              value="<%= locals.employe?.prenom %>"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label required-field">Nom</label>
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-user"></i
                            ></span>
                            <input
                              type="text"
                              class="form-focus"
                              name="nom"
                              required
                              value="<%= locals.employe?.nom %>"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Pseudo</label>
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-at"></i
                            ></span>
                            <input
                              type="text"
                              class="form-focus"
                              name="speudo"
                              value="<%= locals.employe?.pseudo %>"
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="tab-pane fade" id="contact" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <label class="form-label required-field"
                            >Adresse</label
                          >
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-map-marker-alt"></i
                            ></span>
                            <input
                              type="text"
                              class="form-focus"
                              name="adresse"
                              required
                              value="<%= locals.employe?.adresse %>"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label required-field"
                            >Numéro de téléphone</label
                          >
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-phone"></i
                            ></span>
                            <input
                              type="tel"
                              class="form-focus"
                              name="numero"
                              required
                              value="<%= locals.employe?.numero %>"
                            />
                          </div>
                          <small class="text-muted">
                            <i class="fas fa-info-circle"></i> Ce numéro sera
                            utilisé pour la connexion à l'application mobile
                          </small>
                        </div>
                      </div>
                    </div>

                    <div class="tab-pane fade" id="security" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <label class="form-label required-field"
                            >Mot de passe</label
                          >
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-lock"></i
                            ></span>
                            <input
                              type="password"
                              class="form-focus"
                              name="password"
                              required
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="tab-pane fade" id="role" role="tabpanel">
                      <div class="row">
                        <div class="col-md-6">
                          <label class="form-label required-field">Rôle</label>
                          <div class="input-group mb-3">
                            <span class="input-group-text"
                              ><i class="fas fa-user-tag"></i
                            ></span>
                            <select class="form-focus" name="role" required>
                              <option value="">Sélectionner un rôle</option>
                              <option value="Barman">Barman</option>
                              <option value="serveur(euse)">
                                Serveur(euse)
                              </option>
                              <option value="Manager">Manager</option>
                              <option value="gestionnaire">Gestionnaire</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <input
                    type="text"
                    name="session"
                    value="<%= user?.id %>"
                    hidden
                  />
                  <input
                    type="checkbox"
                    name="update"
                    value="<%= locals.update %>"
                    hidden
                  />

                  <div class="d-flex justify-content-between mt-4">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      id="prevBtn"
                    >
                      <i class="fas fa-arrow-left"></i> Précédent
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                      Suivant <i class="fas fa-arrow-right"></i>
                    </button>
                    <button
                      type="submit"
                      class="btn btn-success"
                      id="submitBtn"
                      style="display: none"
                      data-toggle="modal"
                      data-target="#roleModal"
                    >
                      <i class="fas fa-save"></i> <%= locals.update?"Modifier":
                      "Ajouter"%> employé
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- footer part -->
      <div class="footer_part">
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-12">
              <div class="footer_iner text-center">
                <p>
                  2023 © E-Maquis - Designed by
                  <a href="#"> <i class="ti-gun"></i> </a><a href="#"> HNM</a> -
                  <a href="/faq">FAQ</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- main content part end -->
    <div class="menu-overlay"></div>

    <div id="back-top" style="display: none">
      <a title="Go to Top" href="#">
        <i class="ti-angle-up"></i>
      </a>
    </div>

    <!-- footer  -->
    <%- include('partial/script.ejs') %> <%-
    include('partial/scriptNewTemp.ejs') %>

    <script src="/socket.io/socket.io.js "></script>
    <script>
      const socket = io(window.location.origin + window.location.pathname);
      console.log(window.location.origin + window.location.pathname);

      $("form").on("submit", (e) => {
        e.preventDefault();
        isSucces = true;
        const updated = $('input[name="update"]').val() == "true";
        const data = {
          nom: $('input[name="nom"]').val(),
          prenom: $('input[name="prenom"]').val(),
          chef_etablissement: $('input[name="session"]').val(),
          role: $('select[name="role"]').val(),
          email: $('input[name="email"]').val(),
          adresse: $('input[name="adresse"]').val(),
          password: $('input[name="password"]').val(),
          numero: $('input[name="numero"]').val(),
        };

        if (
          !updated &&
          (data.nom == "" ||
            data.prenom == "" ||
            data.email == "" ||
            data.adresse == "" ||
            data.password == "" ||
            data.numero == "" ||
            data.role === "1")
        ) {
          isSucces = false;
          alert("Veuillez remplir tous les champs");
          return;
        }

        if (updated) {
          if (data.role === "1") {
            data.role = "<%= locals.employe?.role %>";
          }
          socket.emit("updateEmploye", {
            userId: "<%= locals.employe?._id%>",
            data,
          });
          console.log("update", {
            userId: "<%= locals.employe?._id%>",
            data,
          });
        } else {
          socket.emit("setemploye", data);
        }

        socket.on("saved", (data) => {
          document.getElementById("alert-success").style.display = "block";
          $("input").val("");
          setTimeout(() => {
            document.getElementById("alert-success").style.display = "none";
            if (data.update) {
              window.location.href = "/utilisateur";
            }
          }, 1000);
        });
        socket.on("bad", () => {
          setTimeout(
            () =>
              (document.getElementById("alert-danger").style.display = "block"),
            1000
          );
        });

        // Determine the role and set the modal content
        const role = $('select[name="role"]').val();
        let modalContent = "";
        let videoUrl = "";

        if (
          role === "serveur(euse)" ||
          role === "Manager" ||
          role === "gestionnaire"
        ) {
          modalContent =
            "L'employé est maintenant enregistré dans votre établissement donc il peut maintenant télécharger l'application mobile sur le PlayStore ou AppStore pour les prises de commandes.";
          videoUrl = "medias/mobile.mp4";
        } else if (role === "Barman") {
          modalContent =
            "L'employé est maintenant enregistré dans votre établissement donc il peut maintenant se connecter sur son espace barman à cette adresse : https://e-maquis.com/emconnexion";
          videoUrl = "medias/barman.mp4";
        }

        // Set the modal content and video
        $("#modalBodyContent").html(`
          <p>${modalContent}</p>
          <video autoplay controls style="width:100%; height:auto;">
            <source src="${videoUrl}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        `);
      });
      const driver = window.driver.js.driver;
      // Définir une variable pour garder une trace si l'action a déjà été effectuée
      let guideAlreadyShownAddUser = false;

      const currentRoute = window.location.pathname;

      const driverObj = driver({
        showProgress: true,
        showAnimation: true,
        animationDuration: 2000,
        showButtons: true,
        showBackButton: true,
        showResetButton: true,
        showCloseButton: true,
        showNextButton: true,
        showSkipButton: true,
        showPrevButton: true,
        showPauseButton: true,
        showPlayButton: true,
        showFullscreenButton: true,
        popoverClass: "driverjs-theme",
        steps: [
          {
            element: "#prenom",
            popover: {
              title: "Entrer le prénom de l'employé",
              description: "Entrer les prénoms de l'employé",
            },
          },
          {
            element: "#nom",
            popover: {
              title: "Entrer le nom",
              description: "Entrer le nom de l'employé",
            },
          },
          {
            element: "#speudo",
            popover: {
              title: "Entrer le pseudo",
              description: "Entrer le pseudo de l'employé",
            },
          },
          {
            element: "#adresse",
            popover: {
              title: "Entrer l'adresse",
              description: "Entrer l'adresse de l'employé",
            },
          },
          {
            element: "#numero",
            popover: {
              title: "Entrer le numéro de téléphone",
              description:
                "Le numéro de téléphone va permettre à la serveuse, au gestionnaire ou au barman de pouvoir se connecter à l'application mobile <b>E-Maquis:Serveur/serveuse</b> disponible sur <b>PlayStore</b> pour pouvoir prendre les commandes des clients, et le Barman aura besoin de ce numéro pour pouvoir se connecter à son espaces de travail Barman sur <b>Web</b>. Le numéro de téléphone doit être unique.",
            },
          },
          {
            element: "#password",
            popover: {
              title: "Entrer le mot de passe",
              description: "Entrer le mot de passe de l'employé",
            },
          },
          {
            element: "#role",
            popover: {
              title: "Choisir le rôle de l'employé",
              description: "Choisir le rôle de l'employé",
            },
          },
          {
            element: "#button",
            popover: {
              title: "Enregistrer",
              description: "Enregistrer l'employé",
            },
          },
        ],
      });
      if (
        currentRoute === "/ajouteruser" &&
        (!localStorage.getItem("guideAlreadyShownAddUser") ||
          Date.now() -
            parseInt(localStorage.getItem("guideAlreadyShownAddUser"), 10) >
            172800000)
      ) {
        driverObj.drive();
        // Mettre à jour la variable pour indiquer que le guide a été affiché
        localStorage.setItem("guideAlreadyShownAddUser", true);
      }

      // Gestion des onglets
      let currentTab = 0;
      const tabs = document.querySelectorAll(".nav-link");
      const progressBar = document.querySelector(".progress-bar");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const submitBtn = document.getElementById("submitBtn");

      function showTab(n) {
        tabs.forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".tab-pane")
          .forEach((pane) => pane.classList.remove("show", "active"));

        tabs[n].classList.add("active");
        document
          .querySelectorAll(".tab-pane")
          [n].classList.add("show", "active");

        progressBar.style.width = ((n + 1) / tabs.length) * 100 + "%";

        prevBtn.style.display = n === 0 ? "none" : "block";
        nextBtn.style.display = n === tabs.length - 1 ? "none" : "block";
        submitBtn.style.display = n === tabs.length - 1 ? "block" : "none";
      }

      nextBtn.addEventListener("click", () => {
        if (validateTab(currentTab)) {
          currentTab++;
          showTab(currentTab);
        }
      });

      prevBtn.addEventListener("click", () => {
        currentTab--;
        showTab(currentTab);
      });

      function validateTab(n) {
        const inputs = document
          .querySelectorAll(".tab-pane")
          [n].querySelectorAll("input[required], select[required]");
        let valid = true;

        inputs.forEach((input) => {
          if (!input.value) {
            input.classList.add("is-invalid");
            valid = false;
          } else {
            input.classList.remove("is-invalid");
          }
        });

        return valid;
      }

      // Initialisation
      showTab(0);
    </script>

    <script src="../js/verifInput.js" defer></script>
    <!-- jQuery  -->

    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/metismenu.min.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/simplebar.min.js"></script>

    <!-- Morris Js-->
    <script src="../plugins/morris-js/morris.min.js"></script>
    <!-- Raphael Js-->
    <script src="../plugins/raphael/raphael.min.js"></script>

    <!-- Morris Custom Js-->
    <script src="assets/pages/dashboard-demo.js"></script>

    <!-- App js -->
    <script src="assets/js/theme.js"></script>

    <!-- Add this modal structure somewhere in your HTML body -->
    <div
      class="modal fade"
      id="roleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="roleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="roleModalLabel">Information</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalBodyContent">
            <!-- Content and videos will be dynamically inserted here -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <!-- Mirrored from demo.dashboardpack.com/user-management-html/add_new_user.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Jul 2021 17:20:09 GMT -->
</html>
