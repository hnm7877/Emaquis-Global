<!DOCTYPE html>
<html lang="fr">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-NT2SW8WBHT"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-NT2SW8WBHT");
    </script>
    <meta charset="utf-8" />
    <title>Tableau de board</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      content="Dashboard E-maquis"
      name="description"
    />
    <meta content="MyraStudio" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
    <script src="vendors/apex_chart/apex-chart2.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="js/confetti.js"></script>

    <script src="js/notifMano.js" type="application/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css"
    />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" />

    <!-- App css -->
    <link
      href="assets/css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/theme.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/metisMenu.css" />

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="../img/paresseux_sous_officiel.png"
    />

    <%- include('partial/newHead.ejs') %> <%-
    include('partial/notifManoScript.ejs') %>
    <script src="js/bootstrap.min.js"></script>
  </head>

  <body class="crm_body_bg">
    <!-- Modal d'annonce des nouvelles fonctionnalités -->
    <div
      class="modal fade"
      id="newFeaturesModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="newFeaturesModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newFeaturesModalLabel">
              <i class="fas fa-star text-warning"></i> Nouvelles Fonctionnalités
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div
              id="featuresCarousel"
              class="carousel slide"
              data-ride="carousel"
            >
              <ol class="carousel-indicators">
                <li
                  data-target="#featuresCarousel"
                  data-slide-to="0"
                  class="active"
                ></li>
                <li data-target="#featuresCarousel" data-slide-to="1"></li>
                <li data-target="#featuresCarousel" data-slide-to="2"></li>
              </ol>
              <div class="carousel-inner">
                <!-- Slide 1: Réserve de stock -->
                <div class="carousel-item active">
                  <div
                    class="premium-slide-img"
                    style="background-image: url('/img/depo2.jpg')"
                  >
                    <div class="premium-slide-overlay"></div>
                    <div class="premium-slide-content">
                      <div class="premium-slide-icon orange-lock">
                        <i class="fas fa-lock"></i>
                      </div>
                      <h2 class="premium-slide-title">Réserve de stock</h2>
                      <p class="premium-slide-desc">
                        Gardez une longueur d'avance : gérez vos réserves et
                        évitez les ruptures grâce à une visibilité complète sur
                        votre stock, même en dehors des heures d'ouverture.
                      </p>
                    </div>
                  </div>
                </div>
                <!-- Slide 2: Boissons offertes -->
                <div class="carousel-item">
                  <div
                    class="premium-slide-img"
                    style="background-image: url('/img/boisson_offerte.jpeg')"
                  >
                    <div class="premium-slide-overlay"></div>
                    <div class="premium-slide-content">
                      <div class="premium-slide-icon green-lock">
                        <i class="fas fa-lock-open"></i>
                      </div>
                      <h2 class="premium-slide-title">Boissons offertes</h2>
                      <p class="premium-slide-desc">
                        Fidélisez vos clients et récompensez vos équipes :
                        offrez des boissons en toute simplicité, avec un suivi
                        précis et une validation sécurisée.
                      </p>
                    </div>
                  </div>
                </div>
                <!-- Slide 3: Option nourriture -->
                <div class="carousel-item">
                  <div
                    class="premium-slide-img"
                    style="background-image: url('/img/tapas.jpeg')"
                  >
                    <div class="premium-slide-overlay"></div>
                    <div class="premium-slide-content">
                      <div class="premium-slide-icon green-lock">
                        <i class="fas fa-lock-open"></i>
                      </div>
                      <h2 class="premium-slide-title">Option nourriture</h2>
                      <p class="premium-slide-desc">
                        Développez votre offre : ajoutez facilement des plats à
                        votre carte, gérez les stocks alimentaires et augmentez
                        votre chiffre d'affaires.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <a
                class="carousel-control-prev"
                href="#featuresCarousel"
                role="button"
                data-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="sr-only">Précédent</span>
              </a>
              <a
                class="carousel-control-next"
                href="#featuresCarousel"
                role="button"
                data-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="sr-only">Suivant</span>
              </a>
            </div>
          </div>
          <div class="modal-footer">
            <div class="premium-info">
              <i class="fas fa-info-circle"></i> Ces fonctionnalités sont
              disponibles dans la version premium
            </div>
            <div>
              <button
                type="button"
                class="btn btn-secondary"
                id="closePremiumModal"
              >
                Fermer
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="activateOptionsBtn"
              >
                <i class="fas fa-bolt"></i> Activer les options
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      #newFeaturesModal .modal-content {
        border-radius: 15px;
        overflow: hidden;
        border: none;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
      }

      #newFeaturesModal .modal-header {
        background: linear-gradient(135deg, #ff9c2c 0%, #ff6b2c 100%);
        color: white;
        border: none;
        padding: 20px;
      }

      #newFeaturesModal .modal-title {
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
      }

      #newFeaturesModal .close {
        color: white;
        opacity: 0.8;
        text-shadow: none;
      }

      #newFeaturesModal .close:hover {
        opacity: 1;
      }

      .feature-card {
        padding: 30px;
        text-align: center;
        background: white;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .feature-image {
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 150px;
      }

      .feature-content h3 {
        color: #2c3e50;
        font-size: 1.5rem;
        margin-bottom: 15px;
        font-weight: 600;
      }

      .feature-content p {
        color: #666;
        font-size: 1.1rem;
        line-height: 1.6;
      }

      .carousel-indicators {
        bottom: -50px;
      }

      .carousel-indicators li {
        background-color: #ff9c2c;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin: 0 5px;
      }

      .carousel-control-prev,
      .carousel-control-next {
        width: 5%;
        opacity: 0.8;
      }

      .carousel-control-prev-icon,
      .carousel-control-next-icon {
        background-color: #ff9c2c;
        border-radius: 50%;
        padding: 20px;
      }

      #newFeaturesModal .modal-footer {
        border-top: none;
        padding: 20px;
        background: #f8f9fa;
      }

      #newFeaturesModal .btn-primary {
        background: #ff9c2c;
        border: none;
        padding: 10px 25px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      #newFeaturesModal .btn-primary:hover {
        background: #ff8c1a;
        transform: translateY(-2px);
      }

      #newFeaturesModal .btn-secondary {
        background: #6c757d;
        border: none;
        padding: 10px 25px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      #newFeaturesModal .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .feature-card {
        animation: fadeInUp 0.5s ease-out;
      }

      .premium-badge {
        display: inline-block;
        background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        margin-top: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        animation: pulse 2s infinite;
      }

      .premium-badge i {
        margin-right: 5px;
      }

      .feature-list {
        list-style: none;
        padding: 0;
        margin-top: 20px;
        text-align: left;
      }

      .feature-list li {
        margin: 10px 0;
        color: #666;
        font-size: 1rem;
      }

      .feature-list li i {
        color: #ff9c2c;
        margin-right: 10px;
        width: 20px;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .feature-card {
        position: relative;
        overflow: hidden;
      }

      .feature-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ff9c2c, #ff6b2c);
      }

      .modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .premium-info {
        color: #666;
        font-size: 0.9rem;
      }

      .premium-info i {
        color: #ff9c2c;
        margin-right: 5px;
      }

      .premium-slide-img {
        position: relative;
        width: 100%;
        min-height: 340px;
        border-radius: 16px;
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: flex-end;
        overflow: hidden;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
      }
      .premium-slide-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.25) 40%,
          rgba(0, 0, 0, 0.65) 100%
        );
        z-index: 1;
      }
      .premium-slide-content {
        position: relative;
        z-index: 2;
        color: #fff;
        padding: 36px 28px 32px 28px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      .premium-slide-icon {
        font-size: 2.2rem;
        margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        padding: 8px 14px 8px 14px;
        background: rgba(255, 255, 255, 0.18);
        backdrop-filter: blur(2px);
      }
      .premium-slide-title {
        font-size: 1.7rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
      }
      .premium-slide-desc {
        font-size: 1.13rem;
        font-weight: 400;
        color: #f7f7f7;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.13);
        max-width: 420px;
      }

      .carousel-control-prev,
      .carousel-control-next {
        z-index: 10 !important;
      }
    </style>

    <script>
      $(document).ready(function () {
        // Afficher la modal au chargement de la page
        $("#newFeaturesModal").modal("show");

        // Fermer la modal avec le bouton Fermer
        $("#closePremiumModal, #newFeaturesModal .close").on(
          "click",
          function () {
            $("#newFeaturesModal").modal("hide");
          }
        );

        // Rediriger vers /profile quand on clique sur Activer les options
        $("#activateOptionsBtn").on("click", function () {
          $("#newFeaturesModal").modal("hide");
          setTimeout(function () {
            window.location.href = "/profile";
          }, 350);
        });

        // Animation des cartes au changement de slide
        $("#featuresCarousel").on("slide.bs.carousel", function () {
          $(".feature-card").css("animation", "none");
          setTimeout(function () {
            $(".feature-card").css("animation", "fadeInUp 0.5s ease-out");
          }, 50);
        });
      });
    </script>

    <%- include('partial/donateModal') %>

    <div id="layout-wrapper">
      <!-- ============================================================== -->
      <!-- Start right Content here -->
      <!-- ============================================================== -->
      <div class="main-content">
        <div class="page-content">
          <div class="container-fluid">
            <!-- start page title -->
            <div class="row">
              <div class="col-12">
                <div
                  class="page-title-box d-flex align-items-center justify-content-between"
                >
                  

                  <!-- <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">Xacton</a></li>
                                        <li class="breadcrumb-item active">Dashboard</li>
                                    </ol>
                                </div>
                                -->
                </div>
              </div>
            </div>
            <!-- end page title -->

            <!-- HEADER MODERNE -->
            <div class="dashboard-header animated-fadeInDown">
              <div class="dashboard-title-row">
                <h1 class="dashboard-title">
                  <i class="fas fa-tachometer-alt"></i> Tableau de bord
                </h1>
                <!--
                <span class="dashboard-badge">Premium</span>
              -->
              </div>
              <div class="dashboard-subtitle">
                Bienvenue sur votre espace de gestion, tout est sous contrôle !
              </div>
            </div>

            <!-- STATISTIQUES CLÉS (toujours en haut) -->
            <div class="row dashboard-stats-row animated-fadeInUp mb-4">
              <div class="col-md-6 col-xl-3">
                <div class="dashboard-card dashboard-card-bg-orange card-animated">
                  <div class="dashboard-card-icon">
                    <lord-icon src="https://cdn.lordicon.com/fmasbomy.json" trigger="loop" delay="3500" style="width: 48px; height: 48px"></lord-icon>
                  </div>
                  <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Total employé(es)</div>
                    <div class="dashboard-card-value animated-counter"><a href="/utilisateur"><%- totalemploye %></a></div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-xl-3">
                <div class="dashboard-card dashboard-card-bg-green card-animated">
                  <div class="dashboard-card-icon">
                    <lord-icon src="https://cdn.lordicon.com/jxynfsur.json" trigger="loop" state="loop-rotate" colors="primary:#ffffff,secondary:#ffc738" style="width: 48px; height: 48px"></lord-icon>
                  </div>
                  <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Ventes du jour</div>
                    <div class="dashboard-card-value animated-counter"><a class="vente-jour" href="/data_table"><%= totalVente %></a></div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-xl-3">
                <div class="dashboard-card dashboard-card-bg-yellow card-animated">
                  <div class="dashboard-card-icon">
                    <lord-icon src="https://cdn.lordicon.com/jdngjjzg.json" trigger="loop" delay="3500" style="width: 48px; height: 48px"></lord-icon>
                  </div>
                  <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Produit le plus vendu</div>
                    <div class="dashboard-card-value dashboard-card-product">
                      <% if(productMostSold?.produit) { %>
                        <img src="<%= productMostSold?.produit?.image %>" alt="img boisson" class="dashboard-product-img" />
                        <span class="produit-plus-vendu"><%= productMostSold?.produit?.nom_produit %> <%= productMostSold?.taille %> x <%= productMostSold?.quantite %></span>
                      <% } else { %>
                        <span>Aucun</span>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-xl-3">
                <div class="dashboard-card dashboard-card-bg-blue card-animated">
                  <div class="dashboard-card-icon">
                    <lord-icon src="https://cdn.lordicon.com/dypzookn.json" trigger="loop" delay="3500" style="width: 48px; height: 48px"></lord-icon>
                  </div>
                  <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Chiffre d'affaires Cette semaine</div>
                    <div class="dashboard-card-value animated-counter"><a class="chiffre-affaires-semaine" href="/bilan"><%= totalVenteWeek %></a></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SECTION VENTES / OBJECTIF / PRODUITS EN RUPTURE (juste en dessous) -->
            <div class="row dashboard-ventes-row animated-fadeInUp">
              <!-- Ventes (Graphique) -->
              <div class="col-lg-7 col-md-12 mb-4">
                <div class="dashboard-block dashboard-block-ventes">
                  <div class="dashboard-block-header">
                    <span class="dashboard-block-title"><i class="fas fa-chart-line"></i> Ventes</span>
                    <div class="dashboard-block-filters">
                      <select class="nice_Select2 form-control" id="chart_week">
                        <option value="">Semaine</option>
                        <% for(let week = 1; week <= weeksInMonth; week++) { %>
                          <option value="<%= week %>" <%= week === currentWeekIndex ? 'selected' : '' %>>Semaine <%= week %></option>
                        <% } %>
                      </select>
                      <select class="nice_Select2 form-control" id="chart_month">
                        <option value="1">Mois</option>
                        <% for(month of months) { %>
                          <option value="<%= month.code %>" <%= month.code === new Date().getMonth() + 1 ? 'selected' : '' %>><%= month.nom %></option>
                        <% } %>
                      </select>
                      <select class="nice_Select2 form-control" id="chart_year">
                        <option value="1">Année</option>
                        <% for(year of years) { %>
                          <option value="<%= year %>" <%= year === new Date().getFullYear() ? 'selected' : '' %>><%= year %></option>
                        <% } %>
                      </select>
                    </div>
                  </div>
                  <div class="dashboard-block-body">
                    <div id="management_bar"></div>
                    <div class="loader_container"><div class="loader"></div></div>
                  </div>
                </div>
              </div>
              <!-- Objectif à atteindre -->
              <div class="col-lg-2 col-md-6 mb-4">
                <div class="dashboard-block dashboard-block-objectif text-center">
                  <div class="dashboard-block-header">
                    <span class="dashboard-block-title"><i class="fas fa-bullseye"></i> Objectif</span>
                  </div>
                  <div class="dashboard-block-body">
                    <div class="objectif-radial">
                      <lord-icon src="https://cdn.lordicon.com/lupuorrc.json" trigger="loop" delay="2000" style="width: 60px; height: 60px;"></lord-icon>
                      <div id="chart-currently"></div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Produits en rupture -->
              <div class="col-lg-3 col-md-6 mb-4">
                <div class="dashboard-block dashboard-block-rupture">
                  <div class="dashboard-block-header">
                    <span class="dashboard-block-title"><i class="fas fa-exclamation-triangle"></i> Produits en rupture</span>
                  </div>
                  <div class="dashboard-block-body">
                    <div class="table-responsive custom-scroll">
                      <% if(Tab.length === 0) { %>
                        <div class="alert alert-success" role="alert">
                          Aucun produit en rupture de stock pour le moment.
                        </div>
                      <% } else { %>
                        <table class="table table-centered table-hover table-xl mb-0 dashboard-table-rupture">
                          <thead>
                            <tr>
                              <th>Produit</th>
                              <th>Qté</th>
                              <th>Taille</th>
                            </tr>
                          </thead>
                          <tbody>
                            <% Tab.forEach(el => { %> <% if(el.quantite === 0 && !el.is_cocktail) { %>
                            <tr>
                              <td>
                                <div class="d-flex align-items-center">
                                  <img src="<%= el.produit.image %>" alt="" class="rupture-img" />
                                  <span class="rupture-nom"><%= el.produit.nom_produit %></span>
                                </div>
                              </td>
                              <td><span class="rupture-quantite"><%= el.quantite %></span></td>
                              <td><span class="rupture-taille"><%= el.taille %></span></td>
                            </tr>
                            <% } %> <% }) %>
                          </tbody>
                        </table>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SECTION INVENTAIRE & DETAILS DES VENTES -->
            <div class="row dashboard-inventaire-row animated-fadeInUp">
              <!-- Inventaire du stock -->
              <div class="col-xl-6 mb-4">
                <div class="dashboard-block dashboard-block-inventaire">
                  <div class="dashboard-block-header">
                    <span class="dashboard-block-title">
                      <lord-icon src="https://cdn.lordicon.com/ghhwiltn.json" trigger="loop" delay="2000" style="width: 32px; height: 32px;"></lord-icon>
                      Inventaire du stock
                    </span>
                  </div>
                  <div class="dashboard-block-body">
                    <div class="table-responsive custom-scroll">
                      <table class="table table-centered table-hover table-xl mb-0 dashboard-table-inventaire">
                        <thead>
                          <tr>
                            <th>Produit</th>
                            <th>Prix achat</th>
                            <th>Prix vente</th>
                            <th>Qté</th>
                            <th>Taille</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% Tab.forEach(el =>{%>
                          <tr>
                            <td>
                              <div class="d-flex align-items-center">
                                <img src="<%= el.produit.image %>" alt="" class="inventaire-img" />
                                <span class="inventaire-nom"><%= el.produit.nom_produit %></span>
                              </div>
                            </td>
                            <td><%= el.prix_achat %> FCFA</td>
                            <td><span class="badge badge-soft-secondary p-2"><%= el.prix_vente %> FCFA</span></td>
                            <td>
                              <% if(el.quantite <= 100 && !el.is_cocktail){ %>
                              <span class="inventaire-quantite inventaire-quantite-low"><%= el.quantite %></span>
                              <% } else{ %>
                              <span class="inventaire-quantite"><%=el.is_cocktail ? "∞": el.quantite %></span>
                              <% } %>
                            </td>
                            <td><%= el.taille %></td>
                          </tr>
                          <%})%>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Détails des ventes -->
              <div class="col-xl-6 mb-4">
                <div class="dashboard-block dashboard-block-ventedetail">
                  <div class="dashboard-block-header">
                    <span class="dashboard-block-title">
                      <lord-icon src="https://cdn.lordicon.com/ivayzoru.json" trigger="loop" delay="2000" style="width: 32px; height: 32px;"></lord-icon>
                      Détails des ventes
                    </span>
                  </div>
                  <div class="dashboard-block-body">
                    <div class="table-responsive custom-scroll">
                      <% for (product of allProductsByDayGrouped) { %>
                      <table class="table table-borderless table-hover table-centered table-nowrap mb-0 dashboard-table-ventedetail">
                        <tbody>
                          <tr class="thumb_vente">
                            <td>
                              <div class="product-image">
                                <img src="<%= product.produit?.image %>" alt="" class="thumb" />
                              </div>
                            </td>
                            <td>
                              <h5 class="font-size-15 mb-1 font-weight-normal"><%= product.prix_vente %> FCFA</h5>
                              <span class="text-muted font-size-12">vente total</span>
                            </td>
                            <td>
                              <h5 class="font-size-17 mb-1 font-weight-normal"><%= product.quantite %></h5>
                              <span class="text-muted font-size-12">nombre vendu</span>
                            </td>
                            <td>
                              <h5 class="font-size-15 mb-1 font-weight-normal"><%= product.produit?.nom_produit %></h5>
                              <span class="text-muted font-size-12"><%= product.taille %></span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- container-fluid -->
        </div>
        <!-- End Page-content -->

        <footer class="footer">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-6">
                <!-- insert la constante year -->
                <%= year %> © HNM.
              </div>
              <div class="col-sm-6">
                <div class="text-sm-right d-none d-sm-block">Design & HNM</div>
              </div>
            </div>
          </div>
        </footer>
      </div>
      <!-- end main content-->
    </div>
    <div class="menu-overlay"></div>
    <style>
      .sidebar .logo .large_logo img {
        width: 70%;
        margin-left: 15%;
      }

      .white_card_body {
        position: relative;
      }

      .loader_container {
        position: absolute;
        inset: 0;
        background-color: rgba(255, 255, 255, 0.5);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }

      .loader {
        border: 10px solid #f3f3f3;
        border-radius: 50%;
        border-top: 10px solid #ff9c2c;
        width: 50px;
        height: 50px;
        -webkit-animation: spin 0.8s linear infinite;
        /* Safari */
        animation: spin 0.8s linear infinite;
      }

      /* Safari */

      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }

        100% {
          -webkit-transform: rotate(360deg);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      .new-year-countdown {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .countdown-content {
        color: #333;
      }

      .countdown-content h2 {
        margin-bottom: 10px;
        font-size: 1.2em;
        color: #ff9c2c;
      }

      #countdown-display {
        font-size: 1.1em;
        font-weight: bold;
      }

      #countdown-display span {
        color: #ff9c2c;
        padding: 0 5px;
      }

      @media (max-width: 768px) {
        .new-year-countdown {
          position: relative;
          top: 0;
          right: 0;
          margin: 10px;
        }
      }

      canvas#confetti-canvas {
        position: fixed !important;
        inset: 0 !important;
        width: 100% !important;
        height: 100% !important;
        z-index: 999 !important;
        pointer-events: none;
      }

      /* HEADER */
      .dashboard-header {
        margin-bottom: 32px;
        padding: 24px 0 8px 0;
        border-radius: 18px;
        background: linear-gradient(90deg, #fff7e6 0%, #ffe5b4 100%);
        box-shadow: 0 4px 24px rgba(255, 156, 44, 0.07);
        text-align: left;
        animation: fadeInDown 0.7s;
      }
      .dashboard-title-row {
        display: flex;
        align-items: center;
        gap: 18px;
      }
      .dashboard-title {
        font-size: 2.2rem;
        font-weight: 700;
        color: #ff9c2c;
        margin: 0;
        letter-spacing: -1px;
      }
      .dashboard-badge {
        background: #ff3c00;
        color: #fff;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 12px;
        padding: 4px 16px;
        margin-left: 8px;
        vertical-align: middle;
        box-shadow: 0 2px 8px rgba(255, 69, 0, 0.13);
      }
      .dashboard-subtitle {
        color: #666;
        font-size: 1.15rem;
        margin-top: 8px;
        margin-left: 4px;
      }

      /* CARTES STATISTIQUES */
      .dashboard-stats-row {
        margin-bottom: 36px;
        gap: 0;
      }
      .dashboard-card {
        min-height: 170px;
        height: 170px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        border-radius: 18px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
        padding: 28px 22px 22px 22px;
        margin-bottom: 24px;
        transition: box-shadow 0.2s, transform 0.2s;
        cursor: pointer;
        color: #fff;
        position: relative;
        overflow: hidden;
      }
      .dashboard-card:hover {
        box-shadow: 0 8px 32px rgba(255, 156, 44, 0.18);
        transform: translateY(-4px) scale(1.03);
      }
      .dashboard-card .dashboard-card-icon {
        margin-bottom: 12px;
        background: none;
        box-shadow: none;
        min-width: 48px;
        min-height: 48px;
      }
      .dashboard-card .dashboard-card-label {
        color: #fff;
        font-size: 1.08rem;
        font-weight: 500;
        margin-bottom: 2px;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
        font-family: "Poppins", sans-serif;
      }
      .dashboard-card .dashboard-card-value {
        font-size: 2rem;
        font-weight: 700;
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
        font-family: "Poppins", sans-serif;
      }
      .vente-jour {
        color: #fff;
        font-family: "Poppins", sans-serif;
      }

      .produit-plus-vendu {
        font-size: 1.2rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
        font-family: "Poppins", sans-serif;
      }
      .chiffre-affaires-semaine {
        font-size: 1.8rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
        font-family: "Poppins", sans-serif;
      }
      .dashboard-card .dashboard-card-product span {
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.13);
      }
      .dashboard-card-bg-orange {
        background: linear-gradient(135deg, #ff9c2c 0%, #ffb347 100%);
      }
      .dashboard-card-bg-green {
        background: linear-gradient(135deg, #3ed66c 0%, #1abc9c 100%);
      }
      .dashboard-card-bg-yellow {
        background: linear-gradient(135deg, #ffe259 0%, #ffa751 100%);
      }
      .dashboard-card-bg-blue {
        background: linear-gradient(135deg, #2cbcff 0%, #1e90ff 100%);
      }
      .dashboard-product-img {
        width: 38px;
        height: 38px;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }
      @media (max-width: 991px) {
        .dashboard-card {
          min-height: 140px;
          height: 140px;
        }
      }
      @media (max-width: 767px) {
        .dashboard-card {
          min-height: 110px;
          height: 110px;
          padding: 12px 8px;
        }
        .dashboard-card .dashboard-card-value {
          font-size: 1.2rem;
        }
      }

      /* ANIMATIONS */
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animated-fadeInDown {
        animation: fadeInDown 0.7s;
      }
      .animated-fadeInUp {
        animation: fadeInUp 0.7s;
      }
      .card-animated {
        animation: fadeInUp 0.7s;
      }

      .animated-counter {
        transition: color 0.3s;
      }
      .animated-counter:hover {
        color: #ff9c2c;
      }

      @media (max-width: 991px) {
        .dashboard-header {
          text-align: center;
        }
        .dashboard-title-row {
          flex-direction: column;
          gap: 8px;
        }
        .dashboard-stats-row {
          flex-direction: column;
        }
      }
      @media (max-width: 767px) {
        .dashboard-header {
          padding: 16px 0 4px 0;
        }
        .dashboard-title {
          font-size: 1.3rem;
        }
        .dashboard-card {
          flex-direction: column;
          align-items: flex-start;
          min-height: 90px;
          padding: 18px 10px;
        }
        .dashboard-card-icon {
          min-width: 48px;
          min-height: 48px;
          padding: 8px;
        }
        .dashboard-card-value {
          font-size: 1.2rem;
        }
      }

      .dashboard-ventes-row {
        margin-bottom: 36px;
        display: flex;
        flex-wrap: wrap;
        gap: 0;
      }
      .dashboard-block {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 18px rgba(0,0,0,0.08);
        padding: 22px 18px 18px 18px;
        min-height: 320px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        transition: box-shadow 0.2s, transform 0.2s;
        position: relative;
        margin-bottom: 0;
      }
      .dashboard-block:hover {
        box-shadow: 0 8px 32px rgba(44, 62, 80, 0.13);
        transform: translateY(-4px) scale(1.02);
      }
      .dashboard-block-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
      }
      .dashboard-block-title {
        font-size: 1.18rem;
        font-weight: 700;
        color: #ff9c2c;
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .dashboard-block-filters {
        display: flex;
        gap: 8px;
      }
      .dashboard-block-ventes {
        background: linear-gradient(135deg, #fff7e6 0%, #ffe5b4 100%);
        min-height: 320px;
      }
      .dashboard-block-objectif {
        background: linear-gradient(135deg, #e0ffe6 0%, #b2f7cc 100%);
        min-height: 320px;
        align-items: center;
        justify-content: center;
      }
      .dashboard-block-rupture {
        background: linear-gradient(135deg, #fff0e0 0%, #ffd6b4 100%);
        min-height: 320px;
      }
      .objectif-radial {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 18px;
      }
      .rupture-img {
        width: 32px;
        height: 32px;
        object-fit: contain;
        border-radius: 8px;
        margin-right: 8px;
        box-shadow: 0 2px 8px rgba(255,156,44,0.08);
      }
      .rupture-nom {
        font-size: 1.05rem;
        font-weight: 500;
        color: #e67e22;
      }
      .rupture-quantite {
        color: #e74c3c;
        font-weight: bold;
      }
      .rupture-taille {
        color: #888;
        font-size: 0.98rem;
      }
      .dashboard-table-rupture th, .dashboard-table-rupture td {
        border: none;
        background: transparent;
      }
      @media (max-width: 991px) {
        .dashboard-ventes-row > div { margin-bottom: 18px; }
        .dashboard-block { min-height: 220px; }
      }
      @media (max-width: 767px) {
        .dashboard-ventes-row { flex-direction: column; }
        .dashboard-ventes-row > div { width: 100% !important; max-width: 100%; }
        .dashboard-block { min-height: 180px; padding: 12px 6px; }
        .dashboard-block-title { font-size: 1rem; }
      }

      .dashboard-inventaire-row {
        margin-bottom: 36px;
        display: flex;
        flex-wrap: wrap;
        gap: 0;
      }
      .dashboard-block-inventaire {
        background: linear-gradient(135deg, #e0f7fa 0%, #fffde4 100%);
        min-height: 320px;
      }
      .dashboard-block-ventedetail {
        background: linear-gradient(135deg, #fceabb 0%, #f8b500 100%);
        min-height: 320px;
      }
      .inventaire-img {
        width: 32px;
        height: 32px;
        object-fit: contain;
        border-radius: 8px;
        margin-right: 8px;
        box-shadow: 0 2px 8px rgba(44,62,80,0.08);
      }
      .inventaire-nom {
        font-size: 1.05rem;
        font-weight: 500;
        color: #0097a7;
      }
      .inventaire-quantite {
        color: #27ae60;
        font-weight: bold;
      }
      .inventaire-quantite-low {
        color: #e74c3c;
      }
      .dashboard-table-inventaire th, .dashboard-table-inventaire td {
        border: none;
        background: transparent;
      }
      .dashboard-table-ventedetail th, .dashboard-table-ventedetail td {
        border: none;
        background: transparent;
      }
      @media (max-width: 991px) {
        .dashboard-inventaire-row > div { margin-bottom: 18px; }
        .dashboard-block { min-height: 220px; }
      }
      @media (max-width: 767px) {
        .dashboard-inventaire-row { flex-direction: column; }
        .dashboard-inventaire-row > div { width: 100% !important; max-width: 100%; }
        .dashboard-block { min-height: 180px; padding: 12px 6px; }
        .dashboard-block-title { font-size: 1rem; }
      }
    </style>

    <!-- Begin page -->
    <%- include('partial/newSideBar.ejs') %>
    <!--/ sidebar  -->

    <div id="back-top" style="display: none">
      <a title="Go to Top" href="#">
        <i class="ti-angle-up"></i>
      </a>
    </div>

    <script>
                  const driver = window.driver.js.driver;
            // Définir une variable pour garder une trace si l'action a déjà été effectuée
            let guideAlreadyShown = false;

                  const currentRoute = window.location.pathname;

                  const driverObj = driver({
                    showProgress: true,
                    showAnimation: true,
                    animationDuration: 2000,
                    showButtons: true,
                    showBackButton: true,
                    showResetButton: true,
                    showCloseButton: true,
                    showNextButton: true,
                    showSkipButton: true,
                    showPrevButton: true,
                    showPauseButton: true,
                    showPlayButton: true,
                    showFullscreenButton: true,
                    popoverClass: "driverjs-theme",
                    steps: [
                      {
                        element: "#element-produit",
                        popover: {
                          title: "Ajouter vos produits",
                          description:
                            "En ajoutant les produits de votre établissement, vous aurez une visibilité complète sur l'état du stock. Ainsi, vous pourrez approvisionner à distance si vous constatez une baisse, assurant une gestion efficace et sans interruption de votre inventaire.",
                        },
                      },
                      {
                        element: "#element-employe",
                        popover: {
                          title: "Ajouter les employées de votre établissement",
                          description:
                            "En ajoutant vos employé(e)s, ceux-ci auront accès à la liste des boissons de votre établissement et pourront ainsi effectuer des prises de commandes.",
                        },
                      },
                      {
                        element: "#element-bilan",
                        popover: {
                          title: "Bilan",
                          description:
                            "La section bilan vous permet de consulter vos ventes sur toute les périodes, vous aide à prendre des décisions et vous permet de valoriser vos employés en consultant leurs performances",
                        },
                      },
                    ],
                  });
                  if (currentRoute ==="/dashboard" && (!localStorage.getItem("guideAlreadyShown") || Date.now() - parseInt(localStorage.getItem("guideAlreadyShown"), 10) > 172800000)) {
                    driverObj.drive();
                    // Mettre à jour la variable pour indiquer que le guide a été affiché
                    localStorage.setItem("guideAlreadyShown", true);
                  }
                  // currently sale

                  //const socket = io();
                  const date = new Date();
                  const month = date.getMonth() + 1;
                  const year = date.getFullYear();

                  const celebriteObjective = () => {
                    startConfetti({
                      particleCount: 100,
                      spread: 70,
                      origin: {
                        y: 0.6
                      }
                    });


                    const canvas = document.getElementsByTagName('canvas');

                    if (canvas) {
                      canvas[0].style.position = 'absolute';
                      canvas[0].style.top = '0';
                      canvas[0].style.left = '0';
                      canvas[0].style.width = '100%';
                      canvas[0].style.height = '100%';


                      setTimeout(() => {
                        stopConfetti();
                      }, 3000);

                    }
                  }
                  const ventes = <%- JSON.stringify(venteByDay) %>;
                  const objectivePercent = <%- JSON.stringify(objectivePercent) %>;
                  //     const user_travail_pour = <%- JSON.stringify(user.travail_pour) %>;
                  // const socket = io();
                  // socket.on('connect', () => {
                  //   socket.on(`${user_travail_pour}-editvente`,(data)=>{
                  //     $.notify("Vous avez une vente  !", "success");
                  //     const ventes = <%- JSON.stringify(venteByDay) %>;
                  //     const objectivePercent = <%- JSON.stringify(objectivePercent) %>;

                  //   })
                  // })
                  //  const ventes = <%- JSON.stringify(venteByDay) %>;
                  //  const objectivePercent = <%- JSON.stringify(objectivePercent) %>;


                  if (localStorage.getItem('celebriteObjective') && localStorage.getItem('celebriteObjectiveDate') != new Date().toLocaleDateString()) {
                    localStorage.removeItem('celebriteObjective');
                    localStorage.removeItem('celebriteObjectiveDate');
                  }


                  if (objectivePercent == 100 && !localStorage.getItem('celebriteObjective')) {
                    celebriteObjective();
                    localStorage.setItem('celebriteObjective', true);
                    localStorage.setItem('celebriteObjectiveDate', new Date().toLocaleDateString());
                  }


                  const filterLabelsByMonth = (data, month, year) => {
                    return Object.keys(data).filter(label => {
                      const dateSplit = label.split('/');
                      return Number(dateSplit[0]) == month && dateSplit[2] == year;
                    });
                  }


                  const filterVentesValuesByMonth = (data, month, year) => {
                    return Object.entries(data).map((vente) => {
                      return [vente[0], vente[1].reduce((acc, val) => acc + val.prix, 0)]
                    }).filter(vente => {
                      const dateSplit = vente[0].split('/');
                      return Number(dateSplit[0]) == month && dateSplit[2] == year;
                    }).sort((a, b) => {
                      if (new Date(a[0]) > new Date(b[0])) return -1;
                      if (new Date(a[0]) < new Date(b[0])) return 1;
                      return 0;
                    }).map((vente) => vente[1]);
                  }


                  const fetchData = async () => {
                    const week = $('#chart_week').val();
                    const month = $('#chart_month').val();
                    const year = $('#chart_year').val();

                    $('.loader_container').css('display', 'flex');

                    // loading chart

                    chart_management.updateOptions({
                      labels: [],
                      series: [{
                        name: 'total',
                        type: 'column',
                        data: [],
                      }]
                    })




                    const res = await fetch(`vente-by-month?month=${month>9?month:'0'+month}&year=${year}&week=${week}`);

                    const data = await res.json();
                    console.log("🚀 ~ fetchData ~ data:", data?.
      success
      )


                    if (data.success) {
                      const ventesLabels = filterLabelsByMonth(data?.data, month, year);

                      const ventesValues = filterVentesValuesByMonth(data?.data, month, year);


                      chart_management.updateOptions({
                        labels: ventesLabels.reverse(),
                        series: [{
                          name: 'total',
                          type: 'column',
                          data: ventesValues.reverse(),
                        }]
                      })
                    }

                    $('.loader_container').css('display', 'none');



                  }


                  const ventesLabels = filterLabelsByMonth(ventes, month, year);


                  const ventesValues = filterVentesValuesByMonth(ventes, month, year);

                  var options = {
                    series: [objectivePercent],
                    chart: {
                      height: 300,
                      type: 'radialBar',
                      offsetY: 0,
                    },
                    plotOptions: {
                      radialBar: {
                        startAngle: -90,
                        endAngle: 90,

                        hollow: {
                          margin: 0,
                          size: '70%',
                        },
                        dataLabels: {
                          showOn: 'always',
                          name: {
                            show: true,
                            fontSize: '13px',
                            fontWeight: '700',
                            offsetY: -5,
                            color: ['#98ED58', '#E5ECFF'],
                          },
                          value: {
                            color: ['#98ED58', '#E5ECFF'],
                            fontSize: '30px',
                            fontWeight: '700',
                            offsetY: -40,
                            show: true,
                          },
                        },
                        track: {
                          background: ['rgba(150,103,27,0.35)', '#E5ECFF'],
                          strokeWidth: '100%',
                        },
                      },
                    },
                    colors: ['#98ED58'],
                    stroke: {
                      lineCap: 'round',
                    },
                    labels: ['Progress'],
                  };

                  var chart = new ApexCharts(
                    document.querySelector('#chart-currently'),
                    options
                  );
                  chart.render();

                  /* -------------------------------------------------------------------------- */
                  /*                                     chart                                    */
                  /* -------------------------------------------------------------------------- */

                  options = {
                    chart: {
                      height: 500,
                      type: 'line',
                      stacked: !1,
                      toolbar: {
                        show: !1
                      },
                    },
                    stroke: {
                      width: [0, 2, 4],
                      curve: 'smooth'
                    },
                    plotOptions: {
                      bar: {
                        columnWidth: '30%'
                      }
                    },
                    colors: ['#FF9C2C', '#dfe2e6', '#98ED58'],
                    series: [{
                      name: 'total',
                      type: 'column',
                      data: ventesValues.reverse(),
                    }],
                    fill: {
                      opacity: [0.85, 0.25, 1],
                      gradient: {
                        inverseColors: !1,
                        shade: 'light',
                        type: 'vertical',
                        opacityFrom: 0.85,
                        opacityTo: 0.55,
                        stops: [0, 100, 100, 100],
                      },
                    },
                    labels: ventesLabels.reverse(),
                    markers: {
                      size: 0
                    },
                    xaxis: {
                      type: 'datetime'
                    },
                    yaxis: {
                      title: {
                        text: 'Prix total'
                      }
                    },
                    tooltip: {
                      shared: !0,
                      intersect: !1,
                      y: {
                        formatter: function(e) {
                          return void 0 !== e ? e.toFixed(0) + ' FCFA' : e;
                        },
                      },
                    },
                    grid: {
                      borderColor: '#f1f1f1'
                    },
                  };
                  let chart_management = new ApexCharts(
                    document.querySelector('#management_bar'),
                    options
                  )


                  chart_management.render();
                  console.log("chart management")
                  //
                  console.log("chart management 11")


                  // socket.on('connect', () => {

                  //   //      socket.on(`
                  //   //     $ {
                  //   //       user_travail_pour
                  //   //     } - editvente`, (data) => {
                  //   // //   alert('Edit');
                  //   // //   console.log("chart management 22")

                  //   // // })
                  // })
                  console.log("chart management 33")
                  //chart_week

                  $('#chart_week').on('change', async function() {
                    await fetchData();

                  })


                  $('#chart_month').on('change', async function() {
                    await fetchData();


                  })


                  $('#chart_year').on('change', async function() {
                   await fetchData();


                  })

                  // force update data
                  fetchData();
    </script>

    <script>
      $(document).ready(function () {
        $("#imprimer").on("click", function () {
          window.print();
        });
      });
    </script>

    <!-- jQuery  -->

    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/metismenu.min.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/simplebar.min.js"></script>

    <!-- Morris Js-->
    <script src="../plugins/morris-js/morris.min.js"></script>
    <!-- Raphael Js-->
    <script src="../plugins/raphael/raphael.min.js"></script>

    <!-- Morris Custom Js-->
    <script src="assets/pages/dashboard-demo.js"></script>

    <!-- App js -->
    <script src="assets/js/theme.js"></script>

    <div id="new-year-countdown" class="new-year-countdown">
      <div class="countdown-content">
        <h2>Compte à rebours Nouvel An</h2>
        <div id="countdown-display">
          <span id="days">00</span> jours <span id="hours">00</span> heures
          <span id="minutes">00</span> minutes
          <span id="seconds">00</span> secondes
        </div>
      </div>
    </div>

    <script>
      // Fonction pour le compte à rebours
      function newYearCountdown() {
        const now = new Date();
        const currentYear = now.getFullYear();
        const nextYear = currentYear + 1;
        const newYear = new Date(`January 1, ${nextYear} 00:00:00`).getTime();

        // Vérifier si nous sommes dans les 10 premiers jours de janvier
        const isNewYearPeriod = now.getMonth() === 0 && now.getDate() <= 10;
        // Vérifier si nous sommes dans les 5 premiers jours pour les confettis
        const isConfettiPeriod = now.getMonth() === 0 && now.getDate() <= 5;

        // Si nous sommes dans les 10 premiers jours, afficher le message
        if (isNewYearPeriod) {
          celebrateNewYear();
          return;
        }

        function updateCountdown() {
          const now = new Date().getTime();
          const timeLeft = newYear - now;

          const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const minutes = Math.floor(
            (timeLeft % (1000 * 60 * 60)) / (1000 * 60)
          );
          const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

          document.getElementById("days").innerHTML = days
            .toString()
            .padStart(2, "0");
          document.getElementById("hours").innerHTML = hours
            .toString()
            .padStart(2, "0");
          document.getElementById("minutes").innerHTML = minutes
            .toString()
            .padStart(2, "0");
          document.getElementById("seconds").innerHTML = seconds
            .toString()
            .padStart(2, "0");

          // Quand on arrive à minuit le 1er janvier
          if (timeLeft < 0) {
            clearInterval(countdownTimer);
            celebrateNewYear();
          }
        }

        // Mettre à jour chaque seconde
        const countdownTimer = setInterval(updateCountdown, 1000);
        updateCountdown();
      }

      // Modifier la fonction celebrateNewYear()
      function celebrateNewYear() {
        const countdown = document.getElementById("countdown-display");
        const currentYear = new Date().getFullYear();
        const now = new Date();

        // Vérifier si nous sommes dans les 5 premiers jours de janvier
        const isWithinFirstFiveDays =
          now.getMonth() === 0 && now.getDate() <= 5;

        countdown.innerHTML = `
          <div class="new-year-message">
            <h1>Bonne Année ${currentYear}! 🎉</h1>
            <p>Que cette année vous apporte bonheur et prospérité!</p>
          </div>
        `;

        // Ajouter du style pour le message
        const style = document.createElement("style");
        style.textContent = `
          .new-year-message {
            animation: fadeIn 1s ease-in;
            padding: 10px;
          }
          .new-year-message h1 {
            color: #ff9c2c;
            font-size: 1.5em;
            margin-bottom: 10px;
          }
          .new-year-message p {
            color: #666;
            font-size: 0.9em;
          }
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
        `;
        document.head.appendChild(style);

        // Lancer les confettis seulement si on est dans les 5 premiers jours
        if (isWithinFirstFiveDays) {
          function launchConfettiWave() {
            const commonConfig = {
              particleCount: 50,
              spread: 80,
              startVelocity: 30,
              gravity: 0.5,
              ticks: 400,
              colors: ["#ff9c2c", "#ffffff", "#000000", "#ff0000", "#00ff00"],
              shapes: ["square", "circle"],
              scalar: 1,
              zIndex: 999,
              disableForReducedMotion: true,
            };

            // Créer une grille de points de lancement
            for (let i = 0; i <= 1; i += 0.2) {
              startConfetti({
                ...commonConfig,
                origin: { x: i, y: 0.1 },
                angle: 80 + Math.random() * 20,
              });
            }
          }

          // Lancer la première vague
          launchConfettiWave();

          // Créer un effet continu pendant 5 secondes
          const confettiInterval = setInterval(launchConfettiWave, 200);

          // Arrêter après 5 secondes
          setTimeout(() => {
            clearInterval(confettiInterval);
            stopConfetti();
          }, 5000);
        }
      }

      // Démarrer le compte à rebours
      newYearCountdown();
    </script>

    <style>
      .new-year-countdown {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .countdown-content {
        color: #333;
      }

      .countdown-content h2 {
        margin-bottom: 10px;
        font-size: 1.2em;
        color: #ff9c2c;
      }

      #countdown-display {
        font-size: 1.1em;
        font-weight: bold;
      }

      #countdown-display span {
        color: #ff9c2c;
        padding: 0 5px;
      }

      @media (max-width: 768px) {
        .new-year-countdown {
          position: relative;
          top: 0;
          right: 0;
          margin: 10px;
        }
      }
    </style>
  </body>
</html>
